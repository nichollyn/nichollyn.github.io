<!DOCTYPE html>
<html lang="zh-CN">
<head>

  <script data-ad-client="ca-pub-8791711604224644" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-center-radar.min.css">
  <script src="/lib/pace/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://theinfinitegame.tech').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false,"b2t":true,"scrollpercent":true},
    copycode: {"enable":true,"show_result":true,"style":"flat"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":true,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="Stay hungry, stay foolish.">
<meta property="og:type" content="website">
<meta property="og:title" content="The Infinite Game">
<meta property="og:url" content="https://theinfinitegame.tech/index.html">
<meta property="og:site_name" content="The Infinite Game">
<meta property="og:description" content="Stay hungry, stay foolish.">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="çŒ«å…‹æ¯">
<meta property="article:tag" content="tech, life, philosophy">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://theinfinitegame.tech/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/ilyabirman-likely@2/release/likely.min.css">
  <title>The Infinite Game</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>


<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="The Infinite Game" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">The Infinite Game</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-top">

    <a href="/top/" rel="section"><i class="fa fa-fw fa-signal"></i>çƒ­é—¨</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404.html" rel="section"><i class="fa fa-fw fa-heartbeat"></i>å…¬ç›Š 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="æœç´¢..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/nichollyn" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://theinfinitegame.tech/uncategorized/swift5-7-new-feature/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="çŒ«å…‹æ¯">
      <meta itemprop="description" content="Stay hungry, stay foolish.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="The Infinite Game">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/uncategorized/swift5-7-new-feature/" class="post-title-link" itemprop="url">swift5.7-new-feature</a>
        </h1>

        <div class="post-meta">

          
            <i class="fa fa-thumb-tack"></i>
            <font color="7D26CD">ç½®é¡¶</font>
            <span class="post-meta-divider">|</span>
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2022-06-09 10:18:27" itemprop="dateCreated datePublished" datetime="2022-06-09T10:18:27+08:00">2022-06-09</time>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>6.4k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>6 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ã€ŒSwift èŠ±å›­ã€</p>
<img src="/images/pauline-loroy-U3aF7hgUSrk-unsplash.jpg" width="100%" height="100%" style="margin: 10 auto;">

<blockquote>
<p>å°é¢æ¥è‡ª <a target="_blank" rel="noopener" href="https://unsplash.com/@paulinel?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Pauline Loroy</a> on <a target="_blank" rel="noopener" href="https://unsplash.com/s/photos/dog?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p>
</blockquote>
<blockquote>
<p>è¯‘è‡ª <a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/articles/249/whats-new-in-swift-5-7">https://www.hackingwithswift.com/articles/249/whats-new-in-swift-5-7</a></p>
</blockquote>
<p>Swift 5.7 å˜åŒ–å·¨å¤§ï¼Œæ–°ç‰¹æ€§ä¸­åŒ…æ‹¬æ­£åˆ™è¡¨è¾¾å¼ï¼Œ <code>if let</code> é€Ÿè®°è¯­æ³•ï¼Œä»¥åŠå›´ç»• <code>any</code> å’Œ <code>some</code> å…³é”®å­—çš„ä¸€è‡´æ€§æ”¹åŠ¨ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä¼šé€šè¿‡ä¸€äº›ç¤ºä¾‹æ¥ä»‹ç»è¿™äº›æ–°ç‰¹æ€§ã€‚</p>
<h3 id="è§£åŒ…å¯é€‰å‹çš„-if-let-é€Ÿè®°"><a href="#è§£åŒ…å¯é€‰å‹çš„-if-let-é€Ÿè®°" class="headerlink" title="è§£åŒ…å¯é€‰å‹çš„ if let é€Ÿè®°"></a>è§£åŒ…å¯é€‰å‹çš„ <code>if let</code> é€Ÿè®°</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0345-if-let-shorthand.md">SE-0345</a> å¼•å…¥äº†æ–°çš„é€Ÿè®°è¯­æ³•ï¼Œå¯ä»¥å°†å¯é€‰å‹å±•å¼€ä¸º ** åŒå ** çš„é˜´å½±å˜é‡ã€‚ä»¥åæˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·è§£åŒ…äº†ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name: <span class="type">String?</span> = <span class="string">"Linda"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> name {</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Hello, \(name)!"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å¯¹æ¯”ä¹‹å‰çš„å†™æ³•ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> name = name {</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Hello, \(name)!"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> unwrappedName = name {</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Hello, \(unwrappedName)!"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æ³¨æ„ï¼šè¿™ä¸ªå˜åŒ–å¹¶ä¸é€‚ç”¨äºå¯¹è±¡å†…çš„å±æ€§ï¼Œæ‰€ä»¥åƒä¸‹é¢è¿™æ ·çš„ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">User</span> </span>{</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user: <span class="type">User?</span> = <span class="type">User</span>(name: <span class="string">"Linda"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> user.name {</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Welcome, \(user.name)!"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å¤šè¯­å¥é—­åŒ…ç±»å‹æ¨æ–­"><a href="#å¤šè¯­å¥é—­åŒ…ç±»å‹æ¨æ–­" class="headerlink" title="å¤šè¯­å¥é—­åŒ…ç±»å‹æ¨æ–­"></a>å¤šè¯­å¥é—­åŒ…ç±»å‹æ¨æ–­</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0326-extending-multi-statement-closure-inference.md">SE-0326</a> æå¤§åœ°æé«˜äº† Swift å¯¹é—­åŒ…ä½¿ç”¨å‚æ•°å’Œç±»å‹æ¨æ–­çš„èƒ½åŠ›ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ é™¤è®¸å¤šå¿…é¡»æ˜ç¡®æŒ‡å®šè¾“å…¥å’Œè¾“å‡ºç±»å‹çš„å†™æ³•ã€‚</p>
<p>ä¹‹å‰ Swift å¤„ç†é—­åŒ…çš„ä¹¦å†™éš¾å…çç¢ï¼Œä½†ä» Swift 5.7 å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™å¦‚ä¸‹ç®€åŒ–çš„ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> scores = [<span class="number">100</span>, <span class="number">80</span>, <span class="number">85</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> results = scores.<span class="built_in">map</span> { score <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> score &gt;= <span class="number">85</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"\(score)%: Pass"</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"\(score)%: Fail"</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>åœ¨ Swift 5.7 ä¹‹å‰åˆ™å¿…é¡»åƒä¸‹é¢è¿™æ ·ä¹¦å†™ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> oldResults = scores.<span class="built_in">map</span> { score -&gt; <span class="type">String</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> score &gt;= <span class="number">85</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"\(score)%: Pass"</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"\(score)%: Fail"</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Clockï¼ŒInstant-å’Œ-Duration"><a href="#Clockï¼ŒInstant-å’Œ-Duration" class="headerlink" title="Clockï¼ŒInstant å’Œ Duration"></a>Clockï¼ŒInstant å’Œ Duration</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0329-clock-instant-duration.md">SE-0329</a> ä¸º Swift å¼•å…¥äº†ä¸€ç§æ–°çš„æ ‡å‡†åŒ–æ–¹å¼æ¥å¼•ç”¨æ—¶é—´å’ŒæŒç»­æ—¶é—´ã€‚å®ƒå¯ä»¥æ‹†è§£ä¸ºä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š</p>
<ul>
<li>  <code>Clock</code> ä»£è¡¨äº†ä¸€ç§æµ‹é‡æ—¶é—´æµé€çš„æ–¹å¼ã€‚æœ‰ä¸¤ä¸ªå†…ç½®æ—¶é’Ÿï¼šè¿ç»­æ—¶é’Ÿåœ¨ç³»ç»Ÿå¤„äºç¡çœ çŠ¶æ€æ—¶ä¹Ÿä¼šä¿æŒæ—¶é—´é€’å¢ï¼Œè€ŒæŒ‚èµ·æ—¶é’Ÿåˆ™ä¸ä¼šã€‚</li>
<li>  <code>Instant</code> ä»£è¡¨ä¸€ä¸ªç²¾ç¡®çš„ç¬é—´ã€‚</li>
<li>  Durations è¡¨ç¤ºä¸¤ä¸ª <code>Instant</code> ä¹‹é—´ç»è¿‡äº†å¤šå°‘æ—¶é—´ã€‚</li>
</ul>
<p>è¿™ä¸ªæ–°ç‰¹æ€§å¯¹è®¸å¤šäººæ¥è¯´æ¥è”æƒ³åˆ°çš„æœ€ç›´æ¥çš„åº”ç”¨å°±æ˜¯æ–°å‡çº§çš„ <code>Task</code> APIï¼šå®ƒç°åœ¨å¯ä»¥ç”¨æ¯”çº³ç§’æ›´åˆç†çš„æœ¯è¯­æ¥æŒ‡å®šä¼‘çœ æ—¶é•¿ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> await <span class="type">Task</span>.sleep (until: .now +  .seconds (<span class="number">1</span>), clock: .continuous)</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™ä¸ªæ–° API è¿˜æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯èƒ½å¤ŸæŒ‡å®šå®¹å·®ï¼Œä½¿å¾—ç³»ç»Ÿåœ¨ç¡çœ æˆªæ­¢æ—¥æœŸä¹‹åèƒ½å¤Ÿç¨ç­‰ç‰‡åˆ»ï¼Œä»¥ä¾¿æœ€å¤§é™åº¦åœ°æé«˜ç”µæºæ•ˆç‡ã€‚æ‰€ä»¥ï¼Œå‡å¦‚æˆ‘ä»¬æƒ³ sleep è‡³å°‘ 1 ç§’ï¼Œå¹¶ä¸”èƒ½æ¥å—å®ƒæ€»å…±æŒç»­ 1.5 ç§’ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> await <span class="type">Task</span>.sleep (until: .now + .seconds (<span class="number">1</span>), tolerance: .seconds (<span class="number">0.5</span>), clock: .continuous)</span><br></pre></td></tr></tbody></table></figure>
<p>æ—¶é’Ÿå¯¹äºæµ‹é‡æŸäº›ç‰¹å®šçš„å·¥ä½œä¹Ÿå¾ˆæœ‰ç”¨ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³å‘ç”¨æˆ·å±•ç¤ºæ–‡ä»¶å¯¼å‡ºè¿‡ç¨‹èŠ±è´¹äº†å¤šé•¿æ—¶é—´ï¼Œå¯ä»¥ä½¿ç”¨æ—¶é’Ÿçš„</p>
<p><code>measure</code> é—­åŒ…ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> clock = <span class="type">ContinuousClock</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> time = clock.measure {</span><br><span class="line">    <span class="comment">//complex work here</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Took \(time.components.seconds) seconds"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h3><p>Swift 5.7 å¼•å…¥äº†å¤§é‡ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸å…³çš„æ”¹è¿›ï¼Œè¿™æ˜¯ä¸€æ•´å¥—ç›¸äº’å…³è”çš„ææ¡ˆï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>  <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0350-regex-type-overview.md">SE-0350</a> å¼•å…¥äº†æ–°çš„ <code>Regex</code> ç±»å‹</li>
<li>  <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0351-regex-builder.md">SE-0351</a> å¼•å…¥äº†ä¸€ä¸ªç”¨äºåˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼çš„ result builder é©±åŠ¨çš„ DSLã€‚</li>
<li>  <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0354-regex-literals.md">SE-0354</a> å¼•å…¥äº†ä½¿ç”¨ <code>/.../</code> è€Œä¸å•æ˜¯ <code>Regex</code> æ¥å…±åŒåˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼çš„æ–¹å¼ã€‚</li>
<li>  <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0357-regex-string-processing-algorithms.md">SE-0357</a> æ·»åŠ äº†è®¸å¤šæ–°çš„åŸºäºæ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²å¤„ç†ç®—æ³•ã€‚</li>
</ul>
<p>ä¸å…¶ä»–è¯­è¨€å’Œå¹³å°ç›¸æ¯”ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¸€ç›´æ˜¯ Swift è¯­è¨€ä¸€ä¸ªç›¸å½“å¤§çš„ç—›ç‚¹ã€‚</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä»ç®€å•çš„ä¾‹å­å¼€å§‹ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> message = <span class="string">"the cat sat on the mat"</span></span><br><span class="line"><span class="built_in">print</span>(message.ranges (of: <span class="string">"at"</span>))</span><br><span class="line"><span class="built_in">print</span>(message.replacing (<span class="string">"cat"</span>, with: <span class="string">"dog"</span>))</span><br><span class="line"><span class="built_in">print</span>(message.trimmingPrefix (<span class="string">"the "</span>))</span><br></pre></td></tr></tbody></table></figure>
<p>å®ƒä»¬çš„çœŸæ­£å¨åŠ›åœ¨äºä¹Ÿéƒ½æ¥å—æ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(message.ranges (of: /[a-z] at/))</span><br><span class="line"><span class="built_in">print</span>(message.replacing (/[a-m] at/, with: <span class="string">"dog"</span>))</span><br><span class="line"><span class="built_in">print</span>(message.trimmingPrefix (/<span class="type">The</span>/.ignoresCase ()))</span><br></pre></td></tr></tbody></table></figure>
<p>å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸‹é¢æ˜¯å‡ æ¡å¿«é€Ÿå…¥é—¨ï¼š</p>
<ul>
<li>  åœ¨ç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæˆ‘ä»¬è¦æ±‚æ‰€æœ‰åŒ¹é…ä»»ä½•å°å†™å­—æ¯åè·Ÿ â€œatâ€ çš„å­å­—ç¬¦ä¸²çš„èŒƒå›´ï¼Œä»¥ä¾¿æ‰¾åˆ° â€œcatâ€ã€â€œsatâ€ å’Œ â€œmatâ€ çš„ä½ç½®ã€‚</li>
<li>  åœ¨ç¬¬äºŒä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæˆ‘ä»¬åªåŒ¹é…ä» â€œaâ€ åˆ° â€œmâ€ çš„èŒƒå›´ï¼Œæ‰€ä»¥ sat ä¸ä¼šè¢«æ›¿æ¢ï¼Œå®ƒä¼šæ‰“å° â€œthe dog sat on the dogâ€ã€‚</li>
<li>  åœ¨ç¬¬ä¸‰ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæˆ‘ä»¬å¯»æ‰¾ â€œTheâ€ï¼Œä½†å°†æ­£åˆ™è¡¨è¾¾å¼ä¿®æ”¹ä¸ºä¸åŒºåˆ†å¤§å°å†™ï¼Œä»¥ä¾¿åŒ¹é… â€œtheâ€ã€â€œTHEâ€ ç­‰ã€‚</li>
</ul>
<p>æ³¨æ„è¿™äº›æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦‚ä½•ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å­—é¢é‡æ¥ç”Ÿæˆçš„ â€”â€” ä»¥ <code>/</code> å¼€å§‹å’Œç»“æŸã€‚</p>
<p>é™¤äº†æ­£åˆ™è¡¨è¾¾å¼å­—é¢é‡ï¼ŒSwift è¿˜æä¾›äº†ä¸“é—¨çš„ <code>Regex</code> ç±»å‹ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> {</span><br><span class="line">    <span class="keyword">let</span> atSearch = <span class="keyword">try</span> <span class="type">Regex</span>(<span class="string">"[a-z] at"</span>)</span><br><span class="line">    <span class="built_in">print</span>(message.ranges (of: atSearch))</span><br><span class="line">} <span class="keyword">catch</span> {</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Failed to create regex"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™é‡Œä¸¤ç§æ–¹å¼æœ‰ä¸€ä¸ªå…³é”®åŒºåˆ«ï¼šå½“æˆ‘ä»¬ä½¿ç”¨ <code>Regex</code> ä»å­—ç¬¦ä¸²åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼ŒSwift å¿…é¡»åœ¨è¿è¡Œæ—¶è§£æå­—ç¬¦ä¸²ä»¥æ‰¾å‡ºå®ƒåº”è¯¥ä½¿ç”¨çš„å®é™…è¡¨è¾¾å¼ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å­—é¢é‡å…è®¸ Swift <em>åœ¨ç¼–è¯‘æ—¶</em> æ£€æŸ¥ä½ çš„æ­£åˆ™è¡¨è¾¾å¼ï¼šå®ƒå¯ä»¥éªŒè¯æ­£åˆ™è¡¨è¾¾å¼ä¸åŒ…å«é”™è¯¯ï¼Œå¹¶ä¸”è¿˜å¯ä»¥å‡†ç¡®äº†è§£å®ƒå°†åŒ…å«ä»€ä¹ˆåŒ¹é…é¡¹ã€‚</p>
<blockquote>
<p>åœ¨ç¼–è¯‘æ—¶è§£æä½ çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç¡®ä¿å®ƒä»¬æ˜¯æœ‰æ•ˆçš„ â€”â€” ç‰› ğŸºï¼</p>
</blockquote>
<p>æƒ³çŸ¥é“è¿™ä¸ªå·®å¼‚æœ‰å¤šå¼ºå¤§ï¼Œå’±ä»¬æ¥çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> search1 = /<span class="type">My</span> name <span class="keyword">is</span> (.+?) and <span class="type">I'm</span> (\d+) years old./</span><br><span class="line"><span class="keyword">let</span> greeting1 = <span class="string">"My name is Taylor and I'm 26 years old."</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> result = <span class="keyword">try</span> search1.wholeMatch (<span class="keyword">in</span>: greeting1) {</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Name: \(result.1)"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Age: \(result.2)"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™ä¼šåˆ›å»ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¥æŸ¥æ‰¾æŸäº›æ–‡æœ¬ä¸­çš„ä¸¤ä¸ªç‰¹å®šå€¼ï¼Œå¦‚æœæ‰¾åˆ°å®ƒä»¬éƒ½ä¼šæ‰“å°å®ƒä»¬ã€‚ä½†è¯·æ³¨æ„ <code>result</code> å…ƒç»„å¦‚ä½•å°†å…¶åŒ¹é…é¡¹å¼•ç”¨ä¸º <code>.1</code> å’Œ <code>.2</code>ï¼Œå› ä¸º Swift çŸ¥é“å°†å‘ç”Ÿå“ªäº›åŒ¹é…é¡¹ã€‚ ï¼ˆ<code>.0</code> å°†è¿”å›æ•´ä¸ªåŒ¹é…çš„å­—ç¬¦ä¸²ã€‚ï¼‰</p>
<p>äº‹å®ä¸Šï¼Œæ­£åˆ™è¡¨è¾¾å¼è¿˜å…è®¸æˆ‘ä»¬å‘½ååŒ¹é…é¡¹ï¼Œè¿™äº›åŒ¹é…é¡¹ä¼šæµå‘ç”Ÿæˆçš„åŒ¹é…å…ƒç»„ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> search2 = /<span class="type">My</span> name <span class="keyword">is</span> (?&lt;name&gt;.+?) and <span class="type">I'm</span> (?&lt;age&gt;\d+) years old./</span><br><span class="line"><span class="keyword">let</span> greeting2 = <span class="string">"My name is Taylor and I'm 26 years old."</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> result = <span class="keyword">try</span> search2.wholeMatch (<span class="keyword">in</span>: greeting2) {</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Name: \(result.name)"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Age: \(result.age)"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™ç§å®‰å…¨æ€§å¯¹äºä»å­—ç¬¦ä¸²åˆ›å»ºçš„æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸å¯èƒ½çš„ã€‚</p>
<p>ä½† Swift æ›´è¿›ä¸€æ­¥ï¼Œä½ è¿˜å¯ä»¥ä»ç±»ä¼¼äº SwiftUI ä»£ç çš„ DSL è¯­è¨€åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åŒ¹é… â€œæˆ‘çš„åå­—æ˜¯ Taylorï¼Œæˆ‘ 26 å²â€ çš„æ–‡æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªè¿™æ ·çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> search3 = <span class="type">Regex</span> {</span><br><span class="line">    <span class="string">"My name is "</span></span><br><span class="line"></span><br><span class="line">    <span class="type">Capture</span> {</span><br><span class="line">        <span class="type">OneOrMore</span>(.word)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="string">" and I'm "</span></span><br><span class="line"></span><br><span class="line">    <span class="type">Capture</span> {</span><br><span class="line">        <span class="type">OneOrMore</span>(.digit)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="string">" years old."</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æ›´æ£’çš„æ˜¯ï¼Œè¿™ç§ DSL æ–¹æ³•èƒ½å¤Ÿå¯¹å…¶æ‰¾åˆ°çš„åŒ¹é…é¡¹åº”ç”¨è½¬æ¢ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ <code>TryCapture</code> è€Œä¸æ˜¯ <code>Capture</code>ï¼Œåœ¨æ•è·å¤±è´¥æˆ–æœ‰é”™è¯¯æŠ›å‡ºæ—¶ï¼ŒSwift å°†è‡ªåŠ¨è®¤ä¸ºæ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸åŒ¹é…ã€‚å› æ­¤ï¼Œåœ¨æˆ‘ä»¬çš„å¹´é¾„åŒ¹é…çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä»¥ä¸‹ä»£ç æ¥å°†å¹´é¾„å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> search4 = <span class="type">Regex</span> {</span><br><span class="line">    <span class="string">"My name is "</span></span><br><span class="line"></span><br><span class="line">    <span class="type">Capture</span> {</span><br><span class="line">        <span class="type">OneOrMore</span>(.word)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="string">" and I'm "</span></span><br><span class="line"></span><br><span class="line">    <span class="type">TryCapture</span> {</span><br><span class="line">        <span class="type">OneOrMore</span>(.digit)</span><br><span class="line">    } transform: { match <span class="keyword">in</span></span><br><span class="line">        <span class="type">Int</span>(match)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="type">Capture</span>(.digit)</span><br><span class="line"></span><br><span class="line">    <span class="string">" years old."</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä½ ç”šè‡³å¯ä»¥ä½¿ç”¨å…·æœ‰ç‰¹å®šç±»å‹çš„å˜é‡å°†å‘½ååŒ¹é…ç»„åˆåœ¨ä¸€èµ·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> nameRef = <span class="type">Reference</span>(<span class="type">Substring</span>.<span class="keyword">self</span>)</span><br><span class="line"><span class="keyword">let</span> ageRef = <span class="type">Reference</span>(<span class="type">Int</span>.<span class="keyword">self</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> search5 = <span class="type">Regex</span> {</span><br><span class="line">    <span class="string">"My name is "</span></span><br><span class="line"></span><br><span class="line">    <span class="type">Capture</span>(<span class="keyword">as</span>: nameRef) {</span><br><span class="line">        <span class="type">OneOrMore</span>(.word)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="string">" and I'm "</span></span><br><span class="line"></span><br><span class="line">    <span class="type">TryCapture</span>(<span class="keyword">as</span>: ageRef) {</span><br><span class="line">        <span class="type">OneOrMore</span>(.digit)</span><br><span class="line">    } transform: { match <span class="keyword">in</span></span><br><span class="line">        <span class="type">Int</span>(match)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="type">Capture</span>(.digit)</span><br><span class="line"></span><br><span class="line">    <span class="string">" years old."</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> result = greeting.firstMatch (of: search5) {</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Name: \(result [nameRef])"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Age: \(result [ageRef])"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>åœ¨è¿™ä¸‰ä¸ªé€‰é¡¹ä¸­ï¼Œæˆ‘æ€€ç–‘æ­£åˆ™è¡¨è¾¾å¼æ–‡å­—ä¼šå¾—åˆ°æœ€å¹¿æ³›çš„ä½¿ç”¨ã€‚å°½ç®¡åœ¨ Swift 6 å‘å¸ƒä¹‹å‰ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯¹å®ƒä»¬çš„æ”¯æŒå°†è¢«ç¦ç”¨ã€‚ä½ å¯ä»¥æŠŠ â€œ-Xfrontend -enable-bare-slash-regexâ€ æ·»åŠ åˆ° Xcode ä¸­çš„ Swift Flags è®¾ç½®ä»¥å¯ç”¨è¿™ä¸ªè¯­æ³•ç‰¹æ€§ã€‚</p>
<h3 id="åŸºäºé»˜è®¤è¡¨è¾¾å¼çš„ç±»å‹æ¨æ–­"><a href="#åŸºäºé»˜è®¤è¡¨è¾¾å¼çš„ç±»å‹æ¨æ–­" class="headerlink" title="åŸºäºé»˜è®¤è¡¨è¾¾å¼çš„ç±»å‹æ¨æ–­"></a>åŸºäºé»˜è®¤è¡¨è¾¾å¼çš„ç±»å‹æ¨æ–­</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0347-type-inference-from-default-exprs.md">SE-0347</a> æ‰©å±•äº† Swift ä½¿ç”¨æ³›å‹å‚æ•°ç±»å‹çš„é»˜è®¤å€¼çš„èƒ½åŠ›ã€‚è¿™ä¸ªç‰¹æ€§ä¼¼ä¹ç›¸å½“å°ä¼—ï¼Œä½†ç¡®å®é‡è¦ï¼šå¦‚æœä½ æœ‰ä¸€ä¸ªæ³›å‹ç±»å‹æˆ–å‡½æ•°ï¼Œç°åœ¨å¯ä»¥ä¸ºé»˜è®¤è¡¨è¾¾å¼æä¾›ä¸€ä¸ªå…·ä½“ç±»å‹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä»ä»»æ„ç±»å‹çš„åºåˆ—ä¸­è¿”å› <code>count</code> ä¸ªéšæœºé¡¹ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">drawLotto1</span>&lt;T: Sequence&gt;<span class="params">(from options: T, <span class="built_in">count</span>: Int = <span class="number">7</span>)</span></span> -&gt; [<span class="type">T</span>.<span class="type">Element</span>] {</span><br><span class="line">    <span class="type">Array</span>(options.shuffled ().<span class="keyword">prefix</span>(<span class="built_in">count</span>))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™å…è®¸æˆ‘ä»¬ä½¿ç”¨ä»»ä½•ç±»å‹çš„åºåˆ—æ¥è¿è¡Œå‡½æ•°ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²æ•°ç»„æˆ–è€…æ•´æ•°èŒƒå›´ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(drawLotto1 (from: <span class="number">1</span>...<span class="number">49</span>))</span><br><span class="line"><span class="built_in">print</span>(drawLotto1 (from: [<span class="string">"Jenny"</span>, <span class="string">"Trixie"</span>, <span class="string">"Cynthia"</span>], <span class="built_in">count</span>: <span class="number">2</span>))</span><br></pre></td></tr></tbody></table></figure>
<p>SE-0347 å…è®¸æˆ‘ä»¬ä¸ºå‡½æ•°ä¸­çš„ <code>T</code> å‚æ•°æä¾›ä¸€ä¸ªå…·ä½“ç±»å‹ä½œä¸ºé»˜è®¤å€¼ï¼ŒåŒæ—¶å…è®¸æˆ‘ä»¬ä¿æŒä½¿ç”¨å­—ç¬¦ä¸²æ•°ç»„æˆ–ä»»ä½•å…¶ä»–åºåˆ—ç±»å‹çš„çµæ´»æ€§ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">drawLotto2</span>&lt;T: Sequence&gt;<span class="params">(from options: T = <span class="number">1</span>...<span class="number">49</span>, <span class="built_in">count</span>: Int = <span class="number">7</span>)</span></span> -&gt; [<span class="type">T</span>.<span class="type">Element</span>] {</span><br><span class="line">    <span class="type">Array</span>(options.shuffled ().<span class="keyword">prefix</span>(<span class="built_in">count</span>))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™æ ·ä¸€æ¥æˆ‘ä»¬æ—¢å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰åºåˆ—è°ƒç”¨å‡½æ•°ï¼Œä¹Ÿå¯ä»¥è®©é»˜è®¤å€¼æ¥ç®¡ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(drawLotto2 (from: [<span class="string">"Jenny"</span>, <span class="string">"Trixie"</span>, <span class="string">"Cynthia"</span>], <span class="built_in">count</span>: <span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(drawLotto2 ())</span><br></pre></td></tr></tbody></table></figure>
<h3 id="é¡¶çº§ä»£ç çš„å¹¶å‘"><a href="#é¡¶çº§ä»£ç çš„å¹¶å‘" class="headerlink" title="é¡¶çº§ä»£ç çš„å¹¶å‘"></a>é¡¶çº§ä»£ç çš„å¹¶å‘</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0343-top-level-concurrency.md">SE-0343</a> å‡çº§äº† Swift å¯¹é¡¶çº§ä»£ç çš„æ”¯æŒ â€”â€” æƒ³æƒ³ macOS å‘½ä»¤è¡Œå·¥å…·é¡¹ç›®ä¸­çš„ main.swift â€”â€” ä»¥ä¾¿å®ƒæ”¯æŒå¼€ç®±å³ç”¨çš„å¹¶å‘ã€‚è¿™ä¸ªå˜åŒ–çœ‹èµ·æ¥å¾®ä¸è¶³é“ï¼Œä½†ä¸ºäº†æ”¯æŒå®ƒéœ€è¦ç›¸å½“å¤šçš„å·¥ä½œã€‚</p>
<p>å®è·µä¸Šï¼Œè¿™ä¸ªå˜åŒ–æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†è¿™æ ·çš„ä»£ç ç›´æ¥å†™å…¥ main.swift æ–‡ä»¶ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url = <span class="type">URL</span>(string: <span class="string">"https://hws.dev/readings.json"</span>)!</span><br><span class="line"><span class="keyword">let</span> (data, <span class="keyword">_</span>) = <span class="keyword">try</span> await <span class="type">URLSession</span>.shared.data (from: url)</span><br><span class="line"><span class="keyword">let</span> readings = <span class="keyword">try</span> <span class="type">JSONDecoder</span>().decode ([<span class="type">Double</span>].<span class="keyword">self</span>, from: data)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Found \(readings.count) temperature readings"</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>åœ¨è¿™ä¸ªå˜åŒ–ä»¥å‰ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªå…·æœ‰å¼‚æ­¥ <code>main ()</code> æ–¹æ³•çš„ <code>@main</code> ç»“æ„ã€‚å› æ­¤è¯´è¿™ä¸ªå˜åŒ–æ˜¯ä¸€ä¸ªä¸å°çš„æ”¹è¿›ã€‚</p>
<h3 id="ä¸é€æ˜å‚æ•°å£°æ˜"><a href="#ä¸é€æ˜å‚æ•°å£°æ˜" class="headerlink" title="ä¸é€æ˜å‚æ•°å£°æ˜"></a>ä¸é€æ˜å‚æ•°å£°æ˜</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0341-opaque-parameters.md">SE-0341</a> è§£é”äº†åœ¨ä½¿ç”¨æ›´ç®€å•æ³›å‹çš„åœ°æ–¹å¯¹å‚æ•°å£°æ˜ä½¿ç”¨ <code>some</code> çš„èƒ½åŠ›ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç¼–å†™ä¸€ä¸ªæ£€æŸ¥æ•°ç»„æ˜¯å¦æ’åºçš„å‡½æ•°ï¼ŒSwift 5.7 åŠæ›´é«˜ç‰ˆæœ¬å…è®¸æˆ‘ä»¬è¿™æ ·å†™ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isSorted</span><span class="params">(array: [<span class="keyword">some</span> Comparable])</span></span> -&gt; <span class="type">Bool</span> {</span><br><span class="line">    array == array.sorted ()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>[some Comparable]</code> å‚æ•°ç±»å‹æ„å‘³ç€æ­¤å‡½æ•°é€‚ç”¨äºåŒ…å«æŸç§ç±»å‹çš„å…ƒç´ çš„æ•°ç»„ï¼Œè¯¥ç±»å‹éµå¾ª <code>Comparable</code> åè®®ï¼Œè¿™æ˜¯ç­‰æ•ˆé€šç”¨ä»£ç çš„è¯­æ³•ç³–ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isSortedOld</span>&lt;T: Comparable&gt;<span class="params">(array: [T])</span></span> -&gt; <span class="type">Bool</span> {</span><br><span class="line">    array == array.sorted ()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å†™æ›´é•¿çš„çº¦æŸæ‰©å±•ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> <span class="title">where</span> <span class="title">Element</span>: <span class="title">Comparable</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isSorted</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> {</span><br><span class="line">        <span class="keyword">self</span> == <span class="keyword">self</span>.sorted ()</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™ç§ç®€åŒ–çš„æ³›å‹è¯­æ³•ç¡®å®æ„å‘³ç€æˆ‘ä»¬ä¸å†æœ‰èƒ½åŠ›ä¸ºæˆ‘ä»¬çš„ç±»å‹æ·»åŠ æ›´å¤æ‚çš„çº¦æŸï¼Œå› ä¸ºåˆæˆçš„æ³›å‹å‚æ•°æ²¡æœ‰ç‰¹å®šçš„åç§°ã€‚</p>
<p>** é‡è¦æç¤ºï¼š** ä½ å¯ä»¥åœ¨æ˜¾å¼æ³›å‹å‚æ•°å’Œè¿™ç§æ–°çš„æ›´ç®€å•è¯­æ³•ä¹‹é—´åˆ‡æ¢ï¼Œè€Œä¸ä¼šç ´å APIã€‚</p>
<h3 id="ç»“æ„åŒ–çš„ä¸é€æ˜ç»“æœç±»å‹"><a href="#ç»“æ„åŒ–çš„ä¸é€æ˜ç»“æœç±»å‹" class="headerlink" title="ç»“æ„åŒ–çš„ä¸é€æ˜ç»“æœç±»å‹"></a>ç»“æ„åŒ–çš„ä¸é€æ˜ç»“æœç±»å‹</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0328-structural-opaque-result-types.md">SE-0328</a> æ‹“å®½äº†ä¸é€æ˜ç»“æœç±»å‹å¯ä»¥ä½¿ç”¨çš„èŒƒå›´ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä¸€æ¬¡è¿”å›å¤šä¸ªä¸é€æ˜ç±»å‹ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">showUserDetails</span><span class="params">()</span></span> -&gt; (<span class="keyword">some</span> <span class="type">Equatable</span>, <span class="keyword">some</span> <span class="type">Equatable</span>) {</span><br><span class="line">    (<span class="type">Text</span>(<span class="string">"Username"</span>), <span class="type">Text</span>(<span class="string">"@twostraws"</span>))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æˆ‘ä»¬è¿˜å¯ä»¥è¿”å›ä¸é€æ˜ç±»å‹æ•°ç»„ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createUser</span><span class="params">()</span></span> -&gt; [<span class="keyword">some</span> <span class="type">View</span>] {</span><br><span class="line">    <span class="keyword">let</span> usernames = [<span class="string">"@frankefoster"</span>, <span class="string">"@mikaela__caron"</span>, <span class="string">"@museumshuffle"</span>]</span><br><span class="line">    <span class="keyword">return</span> usernames.<span class="built_in">map</span>(<span class="type">Text</span>.<span class="keyword">init</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ç”šè‡³è¿”å›ä¸€ä¸ªåœ¨è°ƒç”¨æ—¶æœ¬èº«è¿”å›ä¸é€æ˜ç±»å‹çš„å‡½æ•°ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createDiceRoll</span><span class="params">()</span></span> -&gt; () -&gt; <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">        <span class="keyword">let</span> diceRoll = <span class="type">Int</span>.random (<span class="keyword">in</span>: <span class="number">1</span>...<span class="number">6</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Text</span>(<span class="type">String</span>(diceRoll))</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å› æ­¤ï¼Œè¿™æ˜¯ Swift è¿›åŒ–è¿‡ç¨‹ä¸­ä¿æŒä¸€è‡´æ€§çš„å¦ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://theinfinitegame.tech/development/eight-swiftui-misuses-and-correction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="çŒ«å…‹æ¯">
      <meta itemprop="description" content="Stay hungry, stay foolish.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="The Infinite Game">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/development/eight-swiftui-misuses-and-correction/" class="post-title-link" itemprop="url">å…«ä¸ªå¸¸è§çš„ SwiftUI è¯¯ç”¨åŠå¯¹åº”çš„æ­£ç¡®æ‰“å¼€æ–¹å¼</a>
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-01-11 20:49:56" itemprop="dateCreated datePublished" datetime="2021-01-11T20:49:56+08:00">2021-01-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/development/" itemprop="url" rel="index">
                    <span itemprop="name">development</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>7.3k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>7 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmk1u8ramjj31900u0b2e.jpg" alt="zdenek-machacek-pqYGHW0_od0-unsplash"></p>
<blockquote>
<p>è¯‘è‡ª <a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/articles/224/common-swiftui-mistakes-and-how-to-fix-them">https://www.hackingwithswift.com/articles/224/common-swiftui-mistakes-and-how-to-fix-them</a></p>
</blockquote>
<p><strong> æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ã€ŒSwift èŠ±å›­ã€</strong></p>
<p>SwiftUI æ˜¯ä¸€ä¸ªåºå¤§ä¸”å¤æ‚çš„æ¡†æ¶ã€‚ä½¿ç”¨è¿™ä¸ªæ¡†æ¶ç¼–ç¨‹æ— ç–‘æ˜¯äº«å—çš„ï¼Œä½†çŠ¯é”™çš„æœºä¼šä¹Ÿä¸å°‘è§ã€‚è¿™ç¯‡æ–‡ç« æˆ‘å°†å¸¦å¤§å®¶é€Ÿè§ˆ SwiftUI åˆå­¦è€…å¸¸çŠ¯çš„ä¸€äº›é”™è¯¯ï¼Œå¹¶æä¾›ä¿®æ­£æ–¹æ¡ˆã€‚</p>
<p>å…¶ä¸­çš„ä¸€äº›é”™è¯¯æ˜¯ç”±äºç®€å•çš„è¯¯è§£å¯¼è‡´ã€‚ç”±äº SwiftUI å¤ªå¤§ï¼Œè¿™ç§æƒ…å†µå…¶å®å®¹æ˜“å‡ºç°ã€‚è€Œå¦ä¸€äº›é”™è¯¯åˆ™ä¸æ·±å…¥ç†è§£ SwiftUI çš„å·¥ä½œæ–¹å¼æœ‰å…³ï¼Œè¿˜æœ‰ä¸€äº›æ˜¯åŸæœ‰çš„æ€ç»´æ–¹å¼å¯¼è‡´ â€”â€” ä½ å¯èƒ½èŠ±äº†å¾ˆå¤šæ—¶é—´ç¼–å†™ view å’Œ modifierï¼Œä½†æ²¡æœ‰æƒ³åˆ°ç”¨ SwiftUI çš„æ–¹å¼ç®€åŒ–ç»“æœã€‚</p>
<p>å¼€é—¨è§å±±ï¼Œä½ ä¸éœ€è¦çŒœæˆ‘ä¼šç»™ä½ å‡†å¤‡ä»€ä¹ˆèœï¼Œè¿™é‡Œæˆ‘ç›´æ¥æŠŠå…«æ¡è¯¯ç”¨å…ˆç®€æ˜æ‰¼è¦åœ°ç½—åˆ—å¦‚ä¸‹ï¼Œç„¶åæˆ‘ä»¬é€æ¡æ·±å…¥å±•å¼€ï¼š</p>
<ol>
<li><p>æ·»åŠ ä¸å¿…è¦çš„ View å’Œ Modifier</p>
</li>
<li><p>åœ¨éœ€è¦ç”¨ <code>@StateObject</code> çš„åœ°æ–¹ç”¨äº† <code>@ObservedObject</code></p>
</li>
<li><p>Modifier é¡ºåºé”™è¯¯</p>
</li>
<li><p>ç»™å±æ€§åŒ…è£…å™¨æ·»åŠ å±æ€§è§‚å¯Ÿè€…</p>
</li>
<li><p>åœ¨éœ€è¦ç”¨æè¾¹æ¡†çš„åœ°æ–¹ä½¿ç”¨äº†æå½¢çŠ¶</p>
</li>
<li><p>Alert å’Œ Sheet ä¸å¯é€‰çŠ¶æ€çš„ä½¿ç”¨</p>
</li>
<li><p>å°è¯•æ”¹å˜ SwiftUI è§†å›¾åé¢çš„ä¸œè¥¿</p>
</li>
<li><p>ç”¨é”™è¯¯çš„èŒƒå›´åŠ¨æ€åˆ›å»ºè§†å›¾</p>
</li>
</ol>
<hr>
<h3 id="1-æ·»åŠ ä¸å¿…è¦çš„-View-å’Œ-Modifier"><a href="#1-æ·»åŠ ä¸å¿…è¦çš„-View-å’Œ-Modifier" class="headerlink" title="1 æ·»åŠ ä¸å¿…è¦çš„ View å’Œ Modifier"></a>1 æ·»åŠ ä¸å¿…è¦çš„ View å’Œ Modifier</h3><p>è®©æˆ‘ä»¬ä»æœ€å¸¸è§çš„ä¸€ä¸ªè¯¯ç”¨å¼€å§‹ï¼Œå®ƒä¼šè®©æˆ‘ä»¬ç¼–å†™æ›´å¤šçš„ SwiftUI ä»£ç ã€‚è¿™ç§è¯¯ç”¨çš„éƒ¨åˆ†åŸå› é€šå¸¸æ˜¯æˆ‘ä»¬åœ¨è§£å†³é—®é¢˜æ—¶ç¼–å†™äº†è®¸å¤šä»£ç ï¼Œä½†æ˜¯æœ€åå¿˜è®°æ•´ç†ä»£ç ã€‚è¿˜æœ‰çš„æ—¶å€™ï¼Œåˆ™æ˜¯æ—§ä¹ æƒ¯ä½œç¥Ÿï¼Œå°¤å…¶æ˜¯å½“ç¼–å†™è€…æ˜¯ä» UIKit æˆ–è€…å…¶ä»– UI æ¡†æ¶è½¬åˆ° SwiftUI ä¸Šã€‚</p>
<p>æ¯”å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›ç”¨ä¸€ä¸ªçº¢è‰²çŸ©å½¢å¡«æ»¡å±å¹•ï¼Ÿç„¶åä½ åƒä¸‹é¢è¿™æ ·ç¼–å†™ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Rectangle</span>()</span><br><span class="line">    .fill (<span class="type">Color</span>.red)</span><br></pre></td></tr></tbody></table></figure>
<p>çš„ç¡®ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥å·¥ä½œ â€”â€” å®ƒèƒ½å‡†ç¡®åœ°å¾—åˆ°ä½ æƒ³è¦çš„æ•ˆæœã€‚ä½†æ˜¯å…¶ä¸­ä¸€åŠçš„ä»£ç æ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸ºä½ åªéœ€è¦åƒä¸‹é¢è¿™æ ·å†™ä¹Ÿèƒ½å®ç°ä¸€æ ·çš„æ•ˆæœï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Color</span>.red</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™æ˜¯å› ä¸ºåœ¨ SwiftUI ä¸­ï¼Œæ‰€æœ‰çš„é¢œè‰²å’Œå½¢çŠ¶éƒ½è‡ªåŠ¨éµå¾ªäº† View åè®®ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬ç›´æ¥å½“æˆè§†å›¾æ¥ä½¿ç”¨ã€‚</p>
<p>ä½ å¯èƒ½ä¹Ÿä¼šç»å¸¸çœ‹è§å½¢çŠ¶è£åˆ‡ï¼Œå› ä¸ºä¸ºäº†å®ç°ç‰¹å®šå½¢çŠ¶ï¼Œåº”ç”¨ <code>clipShape ()</code> æ˜¯ä»¶å¾ˆè‡ªç„¶çš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·è®©æˆ‘ä»¬çš„çº¢è‰²çŸ©å½¢æ‹¥æœ‰åœ†è§’ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Color</span>.red</span><br><span class="line">    .clipShape (<span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">50</span>))</span><br></pre></td></tr></tbody></table></figure>
<p>ä½†è¿™ä¹Ÿæ˜¯ä¸è¦çš„ â€”â€” å€ŸåŠ© <code>cornerRadius ()</code> modifierï¼Œä»£ç å¯ä»¥ç®€åŒ–å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Color</span>.red</span><br><span class="line">    .cornerRadius (<span class="number">50</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>ç§»é™¤è¿™ç±»çš„å†—ä½™ä»£ç éœ€è¦æ—¶é—´ï¼Œå› ä¸ºä½ éœ€è¦è½¬å˜æ€ç»´ä¹ æƒ¯ï¼Œè¿™ä¸€ç‚¹å¯¹äº SwiftUI çš„åˆå­¦è€…æ¥è¯´æ›´åŠ å›°éš¾ã€‚ å› æ­¤ï¼Œå‡å¦‚ä½ ä¸€å¼€å§‹é‡‡ç”¨äº†è¿™äº›æ›´é•¿ç‰ˆæœ¬çš„ä»£ç ï¼Œä¸å¿…æ‹…å¿§ï¼Œå¤šåŠ è®­ç»ƒã€‚</p>
<h3 id="2-åœ¨éœ€è¦ç”¨-StateObject-çš„åœ°æ–¹ç”¨äº†-ObservedObject"><a href="#2-åœ¨éœ€è¦ç”¨-StateObject-çš„åœ°æ–¹ç”¨äº†-ObservedObject" class="headerlink" title="2 åœ¨éœ€è¦ç”¨ @StateObject çš„åœ°æ–¹ç”¨äº† @ObservedObject"></a>2 åœ¨éœ€è¦ç”¨ <code>@StateObject</code> çš„åœ°æ–¹ç”¨äº† <code>@ObservedObject</code></h3><p>SwiftUI æä¾›äº†ä¼—å¤šå±æ€§åŒ…è£…å™¨ï¼Œå¸®åŠ©æˆ‘ä»¬æ„å»ºæ•°æ®å“åº”å¼çš„ç”¨æˆ·ç•Œé¢ï¼Œå…¶ä¸­æœ€é‡è¦çš„å½“å± <code>@State</code>ï¼Œ <code>@StateObject</code> å’Œ <code>@ObservedObject</code>ã€‚æŒæ¡å®ƒä»¬çš„ä½¿ç”¨åœºæ™¯éå¸¸é‡è¦ï¼Œå› ä¸ºè¯¯ç”¨å®ƒä»¬ä¼šç»™ä½ çš„ä»£ç å¸¦æ¥å„ç§é—®é¢˜ã€‚</p>
<p>ç¬¬ä¸€ä¸ªæ¯”è¾ƒç›´æ¥ï¼š<code>@State</code> ç”¨äºå€¼ç±»å‹å±æ€§ï¼Œå¹¶ä¸”å±æ€§ç”±å½“å‰è§†å›¾æ‹¥æœ‰ã€‚å› æ­¤ï¼Œæ•´æ•°ï¼Œå­—ç¬¦ä¸²ï¼Œæ•°ç»„ç­‰ï¼Œéƒ½æ˜¯åº”ç”¨ <code>@State</code> çš„ç»ä½³åœºæ™¯ã€‚</p>
<p>åä¸¤è€…åˆ™æœ‰ç‚¹ä»¤äººå›°æƒ‘ï¼Œä½ å¯èƒ½ä¼šç»å¸¸çœ‹åˆ°ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataModel</span>: <span class="title">ObservableObject</span> </span>{</span><br><span class="line">    @<span class="type">Published</span> <span class="keyword">var</span> username = <span class="string">"@twostraws"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    @<span class="type">ObservedObject</span> <span class="keyword">var</span> model = <span class="type">DataModel</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">Text</span>(model.username)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å¯ä»¥æ˜ç¡®çš„è¯´ï¼Œè¿™ä¹ˆåšæ˜¯é”™è¯¯çš„ï¼Œå¹¶ä¸”ææœ‰å¯èƒ½åœ¨ä½ çš„åº”ç”¨ä¸­å¸¦æ¥é—®é¢˜ã€‚</p>
<blockquote>
<p>è¯‘è€…æ³¨ï¼šåŸºäºä»£ç ç‰‡æ®µè¯´è¿™æ ·å†™ä¸€å®šæ˜¯é”™è¯¯çš„ï¼Œè¿™ä¸ªè¡¨è¿°æ˜¯ä¸ä¸¥è°¨çš„ã€‚ä½œè€…åº”è¯¥æ˜¯éšå«å‡è®¾äº† <code>ContentView</code> æ˜¯åº”ç”¨çš„é¡¶çº§è§†å›¾ï¼ˆé€šå¸¸æ¥è¯´ï¼Œå¦‚æœä½ ä¸æ”¹å·¥ç¨‹æ¨¡æ¿çš„é»˜è®¤è¾“å‡ºï¼Œ<code>ContentView</code> ä¹Ÿç¡®å®æ˜¯é¡¶çº§è§†å›¾ï¼‰ã€‚å¯¹äºé¡¶çº§è§†å›¾æ¥è¯´ï¼ŒSwiftUI 2.0 åº”å½“ä½¿ç”¨ <code>@StateObject</code> ï¼Œå®ƒæ˜¯ä¸ºäº†è§£å†³ <code>@ObservedObject</code> æˆ–è€… <code>@EnvironmentObject</code> å¯¹è±¡çš„æ‰€æœ‰æƒé—®é¢˜ã€‚ä½†æ˜¯å¯¹äºé™„å±äºé¡¶çº§è§†å›¾çš„è§†å›¾å±‚çº§ï¼Œå„å­è§†å›¾çš„æ•°æ®æºå¯ä»¥æ˜¯ <code>@ObservedObject</code> æˆ–è€… <code>@EnvironmentObject</code>ï¼Œå› ä¸ºå®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸå—é¡¶çº§è§†å›¾ç®¡ç†ï¼Œè¿›è€Œå¯ä»¥ç”±é¡¶çº§è§†å›¾ç»Ÿä¸€ä¿è¯æ•°æ®çš„å¯ç”¨æ€§ã€‚</p>
</blockquote>
<p>æ­£å¦‚æˆ‘å‰é¢è¯´åˆ°çš„ï¼Œ<code>@State</code> è¡¨ç¤ºæŸä¸ªå€¼ç±»å‹å±æ€§ç”±å½“å‰è§†å›¾æ‹¥æœ‰ï¼Œè¿™é‡Œçš„ â€œæ‹¥æœ‰â€ å¾ˆé‡è¦ã€‚è€Œ <code>@StateObject</code> åˆ™ç›¸å½“äºå¼•ç”¨ç±»å‹ç‰ˆæœ¬çš„ <code>@State</code>ã€‚</p>
<p>å› æ­¤ï¼Œä¸Šé¢çš„ä»£ç åº”è¯¥æ”¹æˆè¿™æ ·ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">StateObject</span> model = <span class="type">DataModel</span>()</span><br></pre></td></tr></tbody></table></figure>
<p>å½“ä½ ä½¿ç”¨ <code>@ObservedObject</code> æ¥åˆ›å»ºæŸä¸ªå¯¹è±¡å®ä¾‹æ—¶ï¼Œä½ çš„è§†å›¾å¹¶ä¸æ‹¥æœ‰è¿™ä¸ªå¯¹è±¡å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªå®ä¾‹å¯ä»¥åœ¨ä»»ä½•æ—¶å€™è¢«é”€æ¯ï¼ˆè¯‘è€…æ³¨ï¼šè§†å›¾æ— æ³•äº†è§£ä¹Ÿæ— æ³•å¹²é¢„è¿™ä¸ªæ—¶æœºï¼‰ã€‚ç‹¡çŒ¾çš„æ˜¯ï¼Œå¯¹è±¡åœ¨è§†å›¾è¿˜éœ€è¦ç”¨å®ƒæ—¶è¢«é”€æ¯çš„æƒ…å†µåªæ˜¯å¶å°”å‘ç”Ÿï¼Œæ‰€ä»¥ä½ å¯èƒ½è®¤ä¸ºä½ çš„ä»£ç å¾ˆå®Œç¾ã€‚</p>
<p>éœ€è¦è®°ä½çš„é‡ç‚¹æ˜¯ <code>@State</code> å’Œ <code>@StateObject</code> è¡¨ç¤º â€œè§†å›¾æ‹¥æœ‰æ•°æ®â€ï¼Œè€Œ <code>@ObservedObject</code> å’Œ <code>@EnvironmentObject</code> åˆ™æ²¡æœ‰ã€‚</p>
<h3 id="3-Modifier-é¡ºåºé”™è¯¯"><a href="#3-Modifier-é¡ºåºé”™è¯¯" class="headerlink" title="3 Modifier é¡ºåºé”™è¯¯"></a>3 Modifier é¡ºåºé”™è¯¯</h3><p>Modifier çš„é¡ºåºåœ¨ SwiftUI ä¸­è‡³å…³é‡è¦ã€‚é¡ºåºé”™è¯¯ä¸ä»…ä¼šå¯¼è‡´å¸ƒå±€åœ¨ä¸Šè§†è§‰ä¸Šçš„åå·®ï¼Œä¹Ÿä¼šå¯¼è‡´å…¶è¡Œä¸ºçš„é”™è¯¯ã€‚</p>
<p>è§£é‡Šè¿™ä¸ªé—®é¢˜æœ€ç»å…¸çš„ä¾‹å­æ˜¯ <code>padding</code> å’Œ <code>background</code> çš„ä½¿ç”¨ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">"Hello, World!"</span>)</span><br><span class="line">    .font (.largeTitle)</span><br><span class="line">    .background (<span class="type">Color</span>.green)</span><br><span class="line">    .padding ()</span><br></pre></td></tr></tbody></table></figure>
<p>ç”±äºæˆ‘ä»¬åœ¨ <code>background</code> é¢œè‰²ä¹‹ååº”ç”¨ <code>padding</code>ï¼Œé¢œè‰²åªä¼šè¢«ç›´æ¥åº”ç”¨åœ¨æ–‡æœ¬å‘¨å›´ï¼Œè€Œä¸æ˜¯è¢«æ·»åŠ ç•™ç™½ä¹‹åçš„æ–‡æœ¬å‘¨å›´ã€‚å¦‚æœä½ å¸Œæœ›ç•™ç™½å’Œæ–‡æœ¬èƒŒæ™¯éƒ½æ˜¯ç»¿è‰²ï¼Œåº”è¯¥å°†ä»£ç æ”¹æˆä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">"Hello, World!"</span>)</span><br><span class="line">    .font (.largeTitle)</span><br><span class="line">    .padding ()</span><br><span class="line">    .background (<span class="type">Color</span>.green)</span><br></pre></td></tr></tbody></table></figure>
<p>å½“ä½ å°è¯•è°ƒæ•´è§†å›¾ä½ç½®æ—¶ï¼Œè¿™ä¸ªåŸç†ä¼šè®©äº‹æƒ…å˜å¾—æ›´æœ‰è¶£ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ<code>offset ()</code> modifier ä¼šä¿®æ”¹ä¸€ä¸ªè§†å›¾è¢«æ¸²æŸ“çš„ä½ç½®ï¼Œä½†å¹¶ä¸å®é™…æ”¹å˜è§†å›¾çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåº”ç”¨åœ¨ <code>offset</code> ä¹‹åçš„ modifier è¡¨ç°å¾—å°±åƒ <code>offset</code> ä»æœªå‘ç”Ÿè¿‡ã€‚</p>
<p>å°è¯•ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">"Hello, World!"</span>)</span><br><span class="line">    .font (.largeTitle)</span><br><span class="line">    .offset (x: <span class="number">15</span>, y: <span class="number">15</span>)</span><br><span class="line">    .background (<span class="type">Color</span>.green)</span><br></pre></td></tr></tbody></table></figure>
<p>ä½ ä¼šå‘ç°æ–‡æœ¬åç§»äº†ï¼Œä½†èƒŒæ™¯é¢œè‰²æ²¡æœ‰åç§»ã€‚ç°åœ¨ï¼Œå°è¯•äº¤æ¢ <code>offset ()</code> å’Œ <code>background ()</code> çš„ä½ç½®ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">"Hello, World!"</span>)</span><br><span class="line">    .font (.largeTitle)</span><br><span class="line">    .background (<span class="type">Color</span>.green)</span><br><span class="line">    .offset (x: <span class="number">15</span>, y: <span class="number">15</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>ç°åœ¨ä½ ä¼šçœ‹åˆ°æ–‡æœ¬å’ŒèƒŒæ™¯éƒ½ç§»åŠ¨äº†ã€‚</p>
<p>å¦å¤–ï¼Œ<code>position ()</code> modifier ä¼šæ”¹å˜ä¸€ä¸ªè§†å›¾åœ¨å…¶çˆ¶èŠ‚ç‚¹ä¸­çš„æ¸²æŸ“ä½ç½®ï¼Œä½†è¿™ä¸€ç‚¹æ˜¯å€ŸåŠ©å®ƒå…ˆåœ¨è§†å›¾å‘¨å›´åº”ç”¨ä¸€ä¸ªå¯ä¼¸å±•å°ºå¯¸çš„ frame æ¥å®ç°çš„ã€‚</p>
<p>å°è¯•ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">"Hello, World!"</span>)</span><br><span class="line">    .font (.largeTitle)</span><br><span class="line">    .background (<span class="type">Color</span>.green)</span><br><span class="line">    .position (x: <span class="number">150</span>, y: <span class="number">150</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>ä½ ä¼šå‘ç°èƒŒæ™¯é¢œè‰²ç´§è´´åœ¨æ–‡æœ¬å››å‘¨ï¼Œå¹¶ä¸”æ•´ä¸ªè§†å›¾è¢«æ”¾ç½®åœ¨å·¦ä¸Šè§’ã€‚ç°åœ¨ï¼Œå°è¯•å¯¹è°ƒ <code>background ()</code> å’Œ <code>position ()</code>ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">"Hello, World!"</span>)</span><br><span class="line">    .font (.largeTitle)</span><br><span class="line">    .position (x: <span class="number">150</span>, y: <span class="number">150</span>)</span><br><span class="line">    .background (<span class="type">Color</span>.green)</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™ä¸€å›ä½ ä¼šå‘ç°æ•´ä¸ªå±å¹•éƒ½å˜æˆç»¿è‰²äº†ã€‚è¿˜æ˜¯å› ä¸º <code>position ()</code> è¦æ±‚ SwiftUI æ”¾ç½®ä¸€ä¸ªå¯ä¼¸ç¼©å°ºå¯¸çš„ frame åœ¨æ–‡æœ¬è§†å›¾å‘¨å›´ï¼Œè¿™å¯¼è‡´è§†å›¾è‡ªåŠ¨å æ»¡äº†æ‰€æœ‰çš„å¯ç”¨ç©ºé—´ã€‚ç„¶åæˆ‘ä»¬ç»™è§†å›¾ä¸Šäº†ç»¿è‰²ï¼Œæ‰€ä»¥æ•´ä¸ªå±å¹•å‘ˆç°ç»¿è‰²ã€‚</p>
<p>ä½ æ‰€åº”æœ‰çš„ç»å¤§å¤šæ•° modifier éƒ½åˆ›å»ºäº†æ–°è§†å›¾ â€”â€” åº”ç”¨ä¸€ä¸ª <code>position</code> æˆ–è€… <code>background</code> æ—¶ï¼Œä½ å®é™…ä¸Šæ˜¯åœ¨å°†ç°æœ‰çš„è§†å›¾åŒ…è£…èµ·æ¥ã€‚è¿™ä¸ªæœºåˆ¶å¯¹äºæˆ‘ä»¬å¤§æœ‰ç”¨å¤„ï¼Œæˆ‘ä»¬å¯ä»¥å¤šæ¬¡åº”ç”¨ modifierï¼Œæ¯”å¦‚æ·»åŠ å¤šå±‚ç•™ç™½å’ŒèƒŒæ™¯ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">"Hello, World!"</span>)</span><br><span class="line">    .font (.largeTitle)</span><br><span class="line">    .padding ()</span><br><span class="line">    .background (<span class="type">Color</span>.green)</span><br><span class="line">    .padding ()</span><br><span class="line">    .background (<span class="type">Color</span>.blue)</span><br></pre></td></tr></tbody></table></figure>
<p>æˆ–è€…åº”ç”¨å¤šä¸ª shadows ä»¥åˆ›å»ºå¾ˆæ·±çš„é˜´å½±æ•ˆæœï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">"Hello, World!"</span>)</span><br><span class="line">    .font (.largeTitle)</span><br><span class="line">    .foregroundColor (.white)</span><br><span class="line">    .shadow (color: .black, radius: <span class="number">10</span>)</span><br><span class="line">    .shadow (color: .black, radius: <span class="number">10</span>)</span><br><span class="line">    .shadow (color: .black, radius: <span class="number">10</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-ç»™å±æ€§åŒ…è£…å™¨æ·»åŠ å±æ€§è§‚å¯Ÿè€…"><a href="#4-ç»™å±æ€§åŒ…è£…å™¨æ·»åŠ å±æ€§è§‚å¯Ÿè€…" class="headerlink" title="4 ç»™å±æ€§åŒ…è£…å™¨æ·»åŠ å±æ€§è§‚å¯Ÿè€…"></a>4 ç»™å±æ€§åŒ…è£…å™¨æ·»åŠ å±æ€§è§‚å¯Ÿè€…</h3><p>æŸäº›æƒ…å†µä¸‹ä½ å¯èƒ½ä¼šä¸ºå±æ€§åŒ…è£…å™¨æ·»åŠ è¯¸å¦‚ <code>didSet</code> è¿™æ ·çš„å±æ€§è§‚å¯Ÿè€…ï¼Œä½†å®ƒä¸ä¼šå¦‚ä½ é¢„æœŸçš„é‚£æ ·å·¥ä½œã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨ä½¿ç”¨æ»‘å—ï¼Œå¸Œæœ›åœ¨æ»‘å—å€¼æ”¹å˜æ—¶æ‰§è¡ŒæŸç§åŠ¨ä½œï¼Œä½ å¯èƒ½ä¼šä¸‹é¢è¿™æ ·ç¼–å†™ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> rating = <span class="number">0.0</span> {</span><br><span class="line">        <span class="keyword">didSet</span> {</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Rating changed to \(rating)"</span>)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">Slider</span>(value: $rating)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä½†æ˜¯ï¼Œè¿™ä¸ª <code>didSet</code> å±æ€§è§‚å¯Ÿè€…æ°¸è¿œéƒ½ä¸ä¼šè¢«è°ƒç”¨ï¼Œå› ä¸ºå±æ€§çš„å€¼æ˜¯ç”±ç»‘å®šç›´æ¥ä¿®æ”¹çš„ï¼Œè€Œä¸æ˜¯æ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°å€¼ã€‚</p>
<p>å¯¹æ­¤ï¼ŒSwiftUI åŸç”Ÿçš„æ–¹å¼æ˜¯ä½¿ç”¨ <code>onChange ()</code> modifierï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> rating = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">Slider</span>(value: $rating)</span><br><span class="line">            .onChange (of: rating) { value <span class="keyword">in</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"Rating changed to \(value)"</span>)</span><br><span class="line">            }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸è¿‡ï¼Œæˆ‘ä¸ªäººæ›´å–œæ¬¢ä¸€ç§ä¸åŒçš„æ–¹æ¡ˆï¼šæˆ‘ä½¿ç”¨åŸºäº Binding çš„æ‰©å±•æ¥è¿”å›æ–°çš„ç»‘å®šï¼Œå…¶ä¸­çš„ <code>get</code> å’Œ <code>set</code> åŒ…è£…çš„å€¼å’Œä¹‹å‰ä¸€æ ·ï¼Œä½†æ˜¯åœ¨æ–°å€¼å¾—åˆ°æ—¶ä¹Ÿä¼šè°ƒç”¨å¤„ç†å‡½æ•°ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Binding</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">onChange</span><span class="params">(<span class="keyword">_</span> handler: @escaping <span class="params">(Value)</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">Binding</span>&lt;<span class="type">Value</span>&gt; {</span><br><span class="line">        <span class="type">Binding</span>(</span><br><span class="line">            <span class="keyword">get</span>: { <span class="keyword">self</span>.wrappedValue },</span><br><span class="line">            <span class="keyword">set</span>: { newValue <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>.wrappedValue = newValue</span><br><span class="line">                handler (newValue)</span><br><span class="line">            }</span><br><span class="line">        )</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æœ‰äº†è¿™ä¸ªæ‰©å±•ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠç»‘å®šçš„åŠ¨ä½œç›´æ¥é™„ç€åœ¨æ»‘å—è§†å›¾ä¸Šï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> rating = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">Slider</span>(value: $rating.onChange (sliderChanged))</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sliderChanged</span><span class="params">(<span class="keyword">_</span> value: Double)</span></span> {</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Rating changed to \(value)"</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æŒ‘é€‰æœ€é€‚åˆä½ çš„æ–¹æ¡ˆã€‚</p>
<h3 id="5-åœ¨éœ€è¦ç”¨æè¾¹æ¡†çš„åœ°æ–¹ä½¿ç”¨äº†æå½¢çŠ¶"><a href="#5-åœ¨éœ€è¦ç”¨æè¾¹æ¡†çš„åœ°æ–¹ä½¿ç”¨äº†æå½¢çŠ¶" class="headerlink" title="5 åœ¨éœ€è¦ç”¨æè¾¹æ¡†çš„åœ°æ–¹ä½¿ç”¨äº†æå½¢çŠ¶"></a>5 åœ¨éœ€è¦ç”¨æè¾¹æ¡†çš„åœ°æ–¹ä½¿ç”¨äº†æå½¢çŠ¶</h3><p>ä¸ç†è§£ <code>stroke ()</code> å’Œ <code>strokeBorder</code> çš„åŒºåˆ«æ˜¯åˆå­¦è€…å¸¸çŠ¯çš„é”™è¯¯ã€‚å°è¯•ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Circle</span>()</span><br><span class="line">    .stroke (<span class="type">Color</span>.red, lineWidth: <span class="number">20</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>æ³¨æ„çœ‹ï¼Œä½ ä¼šå‘ç°åœ†çš„å·¦è¾¹ç¼˜å’Œå³è¾¹ç¼˜æ€ä¹ˆä¸è§äº†ï¼Ÿï¼ˆè¯‘è€…ï¼šè¿™é‡Œé¢„è®¾ä½ æ˜¯ç«–å±è¿è¡Œç¨‹åºï¼Œé«˜åº¦å¤§äºå®½é«˜ï¼‰è¿™æ˜¯å› ä¸º <code>stroke ()</code> modifier ä¼šæŠŠæè¾¹å±…ä¸­å¯¹é½åœ¨å½¢çŠ¶çš„è½®å»“çº¿ä¸Šï¼Œæ‰€ä»¥ä¸€ä¸ª 20 ä¸ªç‚¹çš„çº¢è‰²æè¾¹ä¼šç»˜åˆ¶ 10 ä¸ªç‚¹åˆ°å½¢çŠ¶çš„è¾¹ç¼˜çº¿å¤–éƒ¨ï¼Œ10 ä¸ªç‚¹åœ¨è¾¹ç¼˜çº¿å†…éƒ¨ â€”â€” è¿™å°±å¯¼è‡´äº†ä½ çœ‹åˆ°åœ†å½¢çš„å·¦å³è¶…å‡ºå±å¹•çš„ç°è±¡ã€‚</p>
<p>ä½œä¸ºå¯¹ç…§ï¼Œ<code>strokeBorder ()</code> åˆ™æ˜¯æŠŠæ•´ä¸ªæè¾¹éƒ½ç»˜åˆ¶åœ¨å½¢çŠ¶å†…éƒ¨ï¼Œæ‰€ä»¥å®ƒä¸ä¼šæ”¾å¤§å½¢çŠ¶çš„è¾¹æ¡†ã€‚</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Circle</span>()</span><br><span class="line">    .strokeBorder (<span class="type">Color</span>.red, lineWidth: <span class="number">20</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>ç›¸æ¯”äºä½¿ç”¨ <code>strokeBorder ()</code>ï¼Œä½¿ç”¨ <code>stroke ()</code> æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªæ–°å½¢çŠ¶ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ–°è§†å›¾ã€‚è¿™ä½¿å¾—ä½ å¯ä»¥åˆ›å»ºå‡ºæŸäº›æœ¬æ¥éš¾ä»¥å®ç°çš„æ•ˆæœï¼Œæ¯”å¦‚ç»™ä¸€ä¸ªå½¢çŠ¶æä¸¤æ¬¡è¾¹ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Circle</span>()</span><br><span class="line">    .stroke (style: <span class="type">StrokeStyle</span>(lineWidth: <span class="number">20</span>, dash: [<span class="number">10</span>]))</span><br><span class="line">    .stroke (style: <span class="type">StrokeStyle</span>(lineWidth: <span class="number">20</span>, dash: [<span class="number">10</span>]))</span><br><span class="line">    .frame (width: <span class="number">280</span>, height: <span class="number">280</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="6-Alert-å’Œ-Sheet-ä¸å¯é€‰çŠ¶æ€çš„ä½¿ç”¨"><a href="#6-Alert-å’Œ-Sheet-ä¸å¯é€‰çŠ¶æ€çš„ä½¿ç”¨" class="headerlink" title="6 Alert å’Œ Sheet ä¸å¯é€‰çŠ¶æ€çš„ä½¿ç”¨"></a>6 Alert å’Œ Sheet ä¸å¯é€‰çŠ¶æ€çš„ä½¿ç”¨</h3><p>å½“ä½ åœ¨å­¦ä¹ ä½¿ç”¨ sheet å’Œå¯é€‰å‹çš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°æŠŠ sheet çš„å±•ç¤ºç»‘å®šåˆ°åƒä¸‹é¢è¿™æ ·çš„ Booleanï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">User</span>: <span class="title">Identifiable</span> </span>{</span><br><span class="line">    <span class="keyword">let</span> id: <span class="type">String</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> selectedUser: <span class="type">User?</span></span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> showingAlert = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">VStack</span> {</span><br><span class="line">            <span class="type">Button</span>(<span class="string">"Show Alert"</span>) {</span><br><span class="line">                selectedUser = <span class="type">User</span>(id: <span class="string">"@twostraws"</span>)</span><br><span class="line">                showingAlert = <span class="literal">true</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        .alert (isPresented: $showingAlert) {</span><br><span class="line">            <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">"Hello, \(selectedUser!.id)"</span>))</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å½“ç„¶ï¼Œè¿™å¯ä»¥æ­£ç¡®å·¥ä½œ â€”â€” è€Œä¸”è¿™ä¸ªæ–¹æ¡ˆå®¹æ˜“ç†è§£ã€‚ä½†æ˜¯ä¸€æ—¦ä½ è¶Šè¿‡äº†åˆçº§é˜¶æ®µï¼Œä½ å°±åº”å½“è€ƒè™‘æ¢æˆå¯é€‰å‹çš„å®ç°æ–¹æ¡ˆã€‚è¿™ä¸ªæ–¹æ¡ˆå»æ‰äº† Booleanï¼Œä¹Ÿä¸å¿…å¼ºåˆ¶è§£åŒ…ã€‚å”¯ä¸€çš„è¦æ±‚æ˜¯ä½ æ‰€ç›‘å¬çš„ç›®æ ‡éœ€è¦éµå¾ª <code>Identifiable</code>ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>selectedUser</code> å‘ç”Ÿå˜åŒ–çš„ä»»ä½•æ—¶å€™å±•ç¤ºè­¦å‘Šå¼¹çª—ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> selectedUser: <span class="type">User?</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">VStack</span> {</span><br><span class="line">            <span class="type">Button</span>(<span class="string">"Show Alert"</span>) {</span><br><span class="line">                selectedUser = <span class="type">User</span>(id: <span class="string">"@twostraws"</span>)</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        .alert (item: $selectedUser) { user <span class="keyword">in</span></span><br><span class="line">            <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">"Hello, \(user.id)"</span>))</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™ä¼šä½¿å¾—ä½ çš„ä»£ç æ›´åŠ æ˜“äºè¯»å†™ï¼Œå¹¶ä¸”é¿å…å› ä¸ºå¼ºåˆ¶è§£åŒ…å¯èƒ½å¸¦æ¥çš„éº»çƒ¦ã€‚</p>
<h3 id="7-å°è¯•æ”¹å˜-SwiftUI-è§†å›¾åé¢çš„ä¸œè¥¿"><a href="#7-å°è¯•æ”¹å˜-SwiftUI-è§†å›¾åé¢çš„ä¸œè¥¿" class="headerlink" title="7 å°è¯•æ”¹å˜ SwiftUI è§†å›¾åé¢çš„ä¸œè¥¿"></a>7 å°è¯•æ”¹å˜ SwiftUI è§†å›¾åé¢çš„ä¸œè¥¿</h3><p>SwiftUI åˆå­¦è€…æœ€å¸¸çŠ¯çš„ä¸€ä¸ªé”™è¯¯æ˜¯ä»–ä»¬å¸¸å¸¸è¯•å›¾å»æ”¹å˜ SwiftUI è§†å›¾çš„èƒŒæ™¯ã€‚ä»£ç é€šå¸¸é•¿ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">Text</span>(<span class="string">"Hello, World!"</span>)</span><br><span class="line">            .background (<span class="type">Color</span>.red)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™ä¼šå±•ç¤ºä¸€ä¸ªç™½è‰²çš„å±å¹•ï¼Œä¸­é—´æ˜¯çº¢è‰²èƒŒæ™¯è‰²åªåŒ¹é…æ–‡æœ¬åŒºåŸŸçš„æ–‡æœ¬è§†å›¾ã€‚è€Œå¤§å¤šæ•°äººçš„æœ¬æ„å…¶å®æ˜¯æƒ³è®©æ•´ä¸ªå±å¹•çš„èƒŒæ™¯å‘ˆç°å‡ºçº¢è‰²ã€‚è¿™ä¸ªæ—¶å€™ä»–ä»¬ä¼šæƒ³ï¼ŒSwiftUI èƒŒåç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ ·çš„ UIKit è§†å›¾å‘¢ï¼Ÿ</p>
<p>å½“ç„¶ï¼ŒèƒŒåè‚¯å®šæ˜¯æœ‰ä¸€ä¸ª UIKit è§†å›¾ï¼Œå®ƒç”± <code>UIHostingController</code> ç®¡ç†ï¼Œè§’è‰²ç±»ä¼¼äºä¸€ä¸ª UIKit è§†å›¾æ§åˆ¶å™¨ã€‚ä½†æ˜¯å‡å¦‚ä½ é€šè¿‡ SwiftUI è¯•å›¾å»è¸è¶³ UIKit çš„é¢†åœ°ï¼Œä½ çš„æ”¹åŠ¨å¾ˆå¯èƒ½ä¼šè®© SwiftUI å‘ˆç°å‡ºå¥‡æ€ªçš„ç»“æœï¼Œæˆ–è€…ä½ ç”šè‡³éƒ½æ²¡æ³•ç›´æ¥æ”¹åŠ¨ UIKitã€‚</p>
<p>å®é™…ä¸Šï¼Œæƒ³åˆ°è¾¾æˆå¤§å¤šæ•°äººæƒ³è¦çš„æ•ˆæœï¼ŒSwiftUI é‡Œçš„å®ç°æ–¹å¼åº”è¯¥æ˜¯åƒä¸‹é¢è¿™æ ·çš„ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">"Hello, World!"</span>)</span><br><span class="line">    .frame (maxWidth: .infinity, maxHeight: .infinity)</span><br><span class="line">    .background (<span class="type">Color</span>.red)</span><br><span class="line">    .ignoresSafeArea ()</span><br></pre></td></tr></tbody></table></figure>
<h3 id="8-åŠ¨æ€è§†å›¾çš„èŒƒå›´å‚æ•°é”™è¯¯"><a href="#8-åŠ¨æ€è§†å›¾çš„èŒƒå›´å‚æ•°é”™è¯¯" class="headerlink" title="8 åŠ¨æ€è§†å›¾çš„èŒƒå›´å‚æ•°é”™è¯¯"></a>8 åŠ¨æ€è§†å›¾çš„èŒƒå›´å‚æ•°é”™è¯¯</h3><p>æœ‰å¤šä¸ª SwiftUI è§†å›¾çš„æ„é€ å™¨å…è®¸æˆ‘ä»¬ä¼ å…¥èŒƒå›´ï¼Œè¿™ä¸ªäº‹å®è®©è®¸å¤šå¤æ‚è§†å›¾çš„åˆ›å»ºè¿‡ç¨‹å˜å¾—ååˆ†ç®€å•ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦å±•ç¤ºä¸€ä¸ªæ‹¥æœ‰ 4 ä¸ªé¡¹ç›®çš„åˆ—è¡¨ï¼Œæˆ‘ä»¬åªéœ€è¦è¿™æ ·å†™ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> rowCount = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">VStack</span> {</span><br><span class="line">            <span class="type">List</span>(<span class="number">0</span>..&lt;rowCount) { row <span class="keyword">in</span></span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Row \(row)"</span>)</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™æ ·å†™æœ¬èº«æ²¡é—®é¢˜ï¼Œä¸è¿‡ä¸€æ—¦ä½ éœ€è¦åœ¨è¿è¡Œæ—¶æ”¹å˜èŒƒå›´æ—¶ï¼Œé—®é¢˜å°±æ¥äº†ã€‚ä½ çœ‹æˆ‘å·²ç»ç”¨ <code>@State</code> å±æ€§åŒ…è£…å™¨æŠŠæƒ³è¦æ”¹å˜çš„è¡Œæ•°å˜æˆå¯ä¿®æ”¹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæŒ‰é’®æ¥ä¿®æ”¹å®ƒçš„å€¼ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(<span class="string">"Add Row"</span>) {</span><br><span class="line">    rowCount += <span class="number">1</span></span><br><span class="line">}</span><br><span class="line">.padding (.top)</span><br></pre></td></tr></tbody></table></figure>
<p>è¿è¡Œä»£ç ï¼Œç‚¹å‡»æŒ‰é’®ï¼ŒXcode è°ƒè¯•è¾“å‡ºä¼šè¾“å‡ºè­¦å‘Šï¼Œè€Œåˆ—è¡¨è§†å›¾çº¹ä¸ä¸åŠ¨ â€”â€” è¿™ä¸ªæ–¹æ¡ˆä¸ç®¡ç”¨ã€‚</p>
<p>é—®é¢˜å‡ºåœ¨ä½ æ—¢æ²¡æœ‰ä¸ºåˆ—è¡¨çš„å‚æ•°æä¾› <code>Identifiable</code> åè®®å®ç°ï¼Œä¹Ÿæ²¡æœ‰æä¾›æŒ‡å®šçš„ id å‚æ•°ï¼Œä»¥æ­¤å‘Šè¯‰ SwiftUI è¿™ä¸ªèŒƒå›´ä¼šåŠ¨æ€å˜åŒ–ï¼šï¼ˆè¯‘è€…ï¼šå®é™…ä¸Šå¹¶ä¸æ˜¯ â€œå‘Šè¯‰ SwiftUI èŒƒå›´ä¼šåŠ¨æ€å˜åŒ–â€ï¼Œè€Œæ˜¯æ˜ç¡®èŒƒå›´çš„é¡¹æ€æ ·æ‰ç®—å˜åŒ–ã€‚<code>Identifiable</code> æˆ–è€… id å‚æ•°æ˜ç¡®äº†ä¸¤ä¸ªé¡¹ä¹‹é—´æ˜¯å¦‚ä½•åŒºåˆ«ã€‚èƒ½å¤ŸåŒºåˆ«å¼€çš„é¡¹ç›®æ‰èƒ½ä¾¦æµ‹å˜åŒ–ï¼‰ã€‚</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span>(<span class="number">0</span>..&lt;rowCount, id: \.<span class="keyword">self</span>) { row <span class="keyword">in</span></span><br><span class="line">    <span class="type">Text</span>(<span class="string">"Row \(row)"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä»£ç æ”¹æˆè¿™æ ·å°±æ²¡é—®é¢˜äº†ã€‚</p>
<hr>
<p>å°é¢æ¥è‡ª <a target="_blank" rel="noopener" href="https://unsplash.com/@zmachacek?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">ZdenÄ›k MachÃ¡Äek</a> on <a target="_blank" rel="noopener" href="https://unsplash.com/s/photos/owl?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://theinfinitegame.tech/programming/use-nsuseractivity-in-swiftui/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="çŒ«å…‹æ¯">
      <meta itemprop="description" content="Stay hungry, stay foolish.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="The Infinite Game">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/programming/use-nsuseractivity-in-swiftui/" class="post-title-link" itemprop="url">åœ¨ SwiftUI ä¸­ä½¿ç”¨ NSUserActivity</a>
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-12-20 11:04:55" itemprop="dateCreated datePublished" datetime="2020-12-20T11:04:55+08:00">2020-12-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>12 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1glu3tdup4dj318y0u0he0.jpg" alt="chewy-EV9_vVMZTcg-unsplash"></p>
<p>æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ã€ŒSwift èŠ±å›­ã€</p>
<blockquote>
<p>è¯‘è‡ª <a target="_blank" rel="noopener" href="https://swiftui-lab.com/nsuseractivity-with-swiftui/">https://swiftui-lab.com/nsuseractivity-with-swiftui/</a></p>
<p>è¯‘è€…æ³¨ï¼šä½œè€…ä¸ºäº†æ‰©å±•ä»–çš„ SwiftUI åº”ç”¨å»ç ”ç©¶äº† NSUserActivityï¼Œå‘ç°å…³äº NSUserActivity çš„å¤§é‡ä¿¡æ¯éƒ½å·²ç»è¿‡æ—¶äº†ã€‚æ¯”å¦‚ï¼Œç»å¤§å¤šæ•°å…³äº Handoff çš„æ–‡ç« éƒ½æ˜¯ Handoff ç‰¹æ€§åˆšæœ‰çš„æ—¶å€™å‘å¸ƒçš„ï¼Œè€Œé‚£ä¸ªæ—¶å€™è¿˜æ²¡æœ‰ scene çš„æ¦‚å¿µï¼Œæ‰€æœ‰é€»è¾‘éƒ½æ˜¯é€šè¿‡ application çš„ delegate å¤„ç†çš„ã€‚ä¹‹å scene å‡ºç°äº†ï¼Œè®¸å¤šä»£ç è¢«ç§»åˆ°äº† scene delegateï¼ŒåŸæ¥çš„ Handoff ç¤ºä¾‹ä¹Ÿå°±å¤±æ•ˆäº†ã€‚å¦‚æœä½ æ˜¯åˆšå¼€å§‹å­¦ä¹  NSUserActivityï¼Œä¸€å®šä¼šæ„Ÿåˆ°å›°æƒ‘ï¼Œè€Œç°åœ¨ SwiftUI ä¹Ÿæ”¯æŒç”¨æˆ·æ´»åŠ¨ï¼Œä½†ç°åœ¨åˆæ²¡æœ‰ scene äº†ï¼Œå˜åŒ–æ›´å¤§ï¼Œæ‰€ä»¥ä½œè€…è®¤ä¸ºéœ€è¦å†™ä¸€ç¯‡æ–°çš„æ–‡æ¡£æ¥ä»‹ç» SwiftUI ä¸­ NSUserActivity çš„ä½¿ç”¨ã€‚</p>
</blockquote>
<p>NSUserActivity ä»¤äººè´¹è§£çš„å¦ä¸€ä¸ªåŸå› æ˜¯å®ƒæ˜¯ä¸€ä¸ªå¯ä»¥ç”¨æ¥å¤„ç†å¤šä¸ªä¸ç›¸å¹²åŠŸèƒ½çš„ä¸œè¥¿ã€‚å®ƒçš„å„é¡¹å±æ€§åªåœ¨æŸäº›æƒ…å†µä¸‹ç›¸å…³ï¼Œå¤šæ•°æƒ…å†µä¸‹å´æ˜¯æ²¡æœ‰å…³è”çš„ã€‚</p>
<p>ä¸‹é¢æ˜¯æœ‰å…³ NSUserActivity çš„ä¸€äº›æ€»ç»“ï¼š</p>
<ul>
<li><strong>Universal Links</strong>: Universal links æ˜¯å¯ä»¥åœ¨å…³è”åº”ç”¨æˆ–è€… Safari ä¸­æ‰“å¼€çš„ URLã€‚</li>
<li><strong>SiriKit</strong>: Siri å¯ä»¥è°ƒèµ·ä½ çš„åº”ç”¨å¹¶ä¸”å‘ŠçŸ¥ä½ å®ƒæƒ³è¦åšä»€ä¹ˆã€‚</li>
<li><strong>Spotlight</strong>: å®šä¹‰ä½ çš„åº”ç”¨å¯ä»¥åšçš„åŠ¨ä½œï¼Œè¿™äº›åŠ¨ä½œä¼šè¢«å¼•å…¥ Spotlight çš„æœç´¢ç»“æœä¸­ã€‚</li>
<li><strong>Handoff</strong>: å³ â€œæ¥åŠ›â€ï¼ŒæŒ‡ä¸€ä¸ªåº”ç”¨å¯ä»¥ç»§ç»­å¦ä¸€ä¸ªåº”ç”¨çš„å·¥ä½œï¼Œæˆ–è€…ä¸€å°è®¾å¤‡ä¸Šçš„ç›¸åŒåº”ç”¨å¯ä»¥ç»§ç»­å¦ä¸€ä¸ªè®¾å¤‡ä¸Šçš„åº”ç”¨çš„å·¥ä½œã€‚</li>
</ul>
<p>è¿™ç¯‡æ–‡æ¡£ä¼šæä¾›ä¸€ç³»åˆ—ç¤ºä¾‹ï¼Œé€æ­¥ä»‹ç» SwiftUI ä¸­æä¾›çš„ç”¨äºå¤„ç† NSUserActivity çš„æ–¹æ³•ï¼Œå…¶ä¸­ä¸Šé¢æåˆ°çš„æ¯ä¸€ç§æƒ…å†µéƒ½ä¼šæœ‰ç¤ºä¾‹ã€‚</p>
<h3 id="é‡è¦çš„ç¬”è®°"><a href="#é‡è¦çš„ç¬”è®°" class="headerlink" title="é‡è¦çš„ç¬”è®°"></a>é‡è¦çš„ç¬”è®°</h3><p>SwiftUI ä¸­è·Ÿ NSUserActivity æœ‰å…³çš„æ–¹æ³•åŒ…æ‹¬ï¼š<strong>onOpenURL ()</strong>, <strong>userActivity ()</strong>, <strong>onContinueUserActivity ()</strong> å’Œ <strong>handlesExternalEvents ()</strong>ã€‚æ³¨æ„ï¼Œè¿™äº›æ–¹æ³•åªæœ‰å½“ä½ çš„åº”ç”¨é‡‡ç”¨çš„æ˜¯ SwiftUI åº”ç”¨ç”Ÿå‘½å‘¨æœŸæ—¶æ‰èƒ½å·¥ä½œã€‚å¦‚æœä½ çš„é¡¹ç›®è¿˜æ˜¯ä½¿ç”¨ scene delegateï¼Œå¼•å…¥è¿™å‡ ä¸ªæ–¹æ³•ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºä¸‹é¢çš„æ¶ˆæ¯ï¼š</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cannot use Scene methods for URL, NSUserActivity, and other External Events </span><br><span class="line">without using SwiftUI Lifecycle. Without SwiftUI Lifecycle, </span><br><span class="line">advertising and handling External Events wastes resources, and will have unpredictable results.</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸ªäººç»éªŒï¼Œä¸Šé¢çš„æ¶ˆæ¯ä¸­æåˆ°çš„ä¸å¯é¢„æµ‹çš„ç»“æœï¼Œå®é™…ä¸Šå®Œå…¨å¯ä»¥é¢„æµ‹ï¼šæ‰€æœ‰è¿™äº›æ–¹æ³•éƒ½å°†è¢«å¿½ç•¥ã€‚</p>
<h3 id="User-Activity-çš„ä¸¤é¢"><a href="#User-Activity-çš„ä¸¤é¢" class="headerlink" title="User Activity çš„ä¸¤é¢"></a>User Activity çš„ä¸¤é¢</h3><p>æ ¹æ® Apple çš„ <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/foundation/nsuseractivity">å®˜æ–¹æ–‡æ¡£</a>ï¼Œä¸€ä¸ªç”¨æˆ·æ´»åŠ¨ï¼ˆuser activityï¼‰å¯¹è±¡ä»£è¡¨äº†æŸä¸ªåº”ç”¨åœ¨æŸä¸ªæ—¶åˆ»çš„çŠ¶æ€ï¼š</p>
<blockquote>
<p>An <strong>NSUserActivity</strong> object provides a lightweight way to capture the state of your app and put it to use later. You create user activity objects and use them to capture information about what the user was doing, such as viewing app content, editing a document, viewing a web page, or watching a video. When the system launches your app and an activity object is available, your app can use the information in that object to restore itself to an appropriate state.</p>
<p>æŸä¸ª <strong>NSUserActivity</strong> å¯¹è±¡æä¾›ä¸€ç§æ•æ‰ä½ çš„åº”ç”¨çŠ¶æ€çš„è½»é‡çº§æ–¹å¼ã€‚ä½ åˆ›å»º user activity å¯¹è±¡ï¼Œå¹¶ç”¨å®ƒä»¬æ¥æ•è·ç”¨æˆ·æ­£åœ¨åšçš„äº‹æƒ…çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æŸ¥çœ‹åº”ç”¨å†…å®¹ï¼Œç¼–è¾‘æ–‡æ¡£ï¼Œé˜…è§ˆç½‘é¡µï¼Œæˆ–è€…è§‚çœ‹è§†é¢‘ã€‚å½“ç³»ç»Ÿå¯åŠ¨ä½ çš„åº”ç”¨æ—¶ï¼Œå¦‚æœæ´»åŠ¨å¯¹è±¡å¯ç”¨ï¼Œä½ çš„åº”ç”¨å¯ä»¥åˆ©ç”¨å¯¹è±¡ä¸­çš„ä¿¡æ¯æŠŠåº”ç”¨è¿˜åŸæˆåˆé€‚çš„çŠ¶æ€ã€‚</p>
</blockquote>
<p>ç†è§£äº†æ¦‚å¿µï¼Œæˆ‘ä»¬å°±å¯ä»¥åŒºåˆ†ç”¨æˆ·æ´»åŠ¨ä¸­çš„ä¸¤ä¸ªå…³é”®æ—¶åˆ»ï¼šå…¶ä¸€ï¼Œç”¨æˆ·æ´»åŠ¨åˆ›å»ºï¼ˆç¨åè¯´æ˜ä½•æ—¶ã€å¦‚ä½•åˆ›å»ºï¼‰ï¼›å…¶äºŒï¼Œç³»ç»Ÿå†³å®šå¯åŠ¨æˆ–è€…æ¢å¤æŸä¸ªåº”ç”¨ï¼Œå¹¶ä¸”ä¸ºåº”ç”¨æä¾›ä¸€ä¸ª NSUserActivityï¼Œä»¥ä¾¿åº”ç”¨å±•ç¤ºç›¸å…³çš„ UIã€‚æˆ‘ä»¬æ¥ä¸‹æ¥ä¼šå­¦ä¹ å¦‚ä½•åœ¨åº”ç”¨ä¸­å¯¹ç”¨æˆ·æ´»åŠ¨åšå‡ºååº”ã€‚</p>
<p>æ³¨æ„ï¼Œå°½ç®¡ä¸€ä¸ªåº”ç”¨å¯ä»¥æœ‰å¤šä¸ª sceneï¼Œä½†æŸä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ª scene ä¼šè·å¾—ç”¨æˆ·æ´»åŠ¨ã€‚åœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬è¿˜å°†äº†è§£åˆ°è·å–ç”¨æˆ·æ´»åŠ¨çš„ scene æ˜¯å¦‚ä½•è¢«ç¡®å®šçš„â€¦</p>
<hr>
<h3 id="Universal-Links"><a href="#Universal-Links" class="headerlink" title="Universal Links"></a>Universal Links</h3><h5 id="ä»‹ç»-onOpenURL"><a href="#ä»‹ç»-onOpenURL" class="headerlink" title="ä»‹ç» onOpenURL ()"></a>ä»‹ç» onOpenURL ()</h5><p>Universal Links å¯¹äºæŠŠåº”ç”¨é›†æˆåˆ°ç½‘ç«™ååˆ†æœ‰ç”¨ã€‚å»ºç«‹ Universal Links éœ€è¦å‡ ä¸ªæ­¥éª¤ï¼ŒApple ä¸ºå…¶æä¾›äº†è¯¦ç»†çš„æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://developer.apple.com/ios/universal-links/">Universal Links</a>ã€‚</p>
<p>åœ¨ SwiftUI ä¸­ä½¿ç”¨ <strong>NSUserActivity</strong> çš„æ‰€æœ‰ç”¨æ³•ä¸­ï¼ŒUniversal Links æ˜¯æœ€å®¹æ˜“å®ç°çš„ã€‚å°½ç®¡ Universal Links æœ¬è´¨ä¸Šæ˜¯ä½¿ç”¨ NSUserActivity æ¥å¯åŠ¨æˆ–è€…æ¢å¤ä½ çš„åº”ç”¨ï¼Œä½†å‡å¦‚ä½ çš„åº”ç”¨æ˜¯èµ° SwiftUI åº”ç”¨ç”Ÿå‘½å‘¨æœŸï¼Œä½ å´æ ¹æœ¬çœ‹ä¸åˆ° NSUserActivity çš„è¸ªå½±ï¼</p>
<p>åœ¨ UIKit é‡Œå®ç° Universal Links ï¼Œä¸€èˆ¬æ˜¯åœ¨ scene delegate é‡Œè¿™ä¹ˆåšï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">scene</span><span class="params">(<span class="keyword">_</span> scene: UIScene, <span class="keyword">continue</span> userActivity: NSUserActivity)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> userActivity.activityType == <span class="type">NSUserActivityTypeBrowsingWeb</span>  {</span><br><span class="line">        doSomethingWith (url: userActivity.webpageURL)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä½†ç°åœ¨æ²¡æœ‰äº† scene delegateï¼Œæˆ‘ä»¬åªéœ€è¦ç®€å•åœ°ä½¿ç”¨ <code>onOpenURL</code> æ–¹æ³•ï¼Œå®ƒä¼šå¾—åˆ° <code>URL</code> å¯¹è±¡ï¼Œè€Œä¸æ˜¯ NSUserActivity å¯¹è±¡ï¼š</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">SomeView</span>()</span><br><span class="line">            .onOpenURL { url <span class="keyword">in</span></span><br><span class="line">                doSomethingWith (url: url)</span><br><span class="line">            }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">doSomethingWith</span><span class="params">(url: URL?)</span></span> {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></h2><h3 id="SiriKit"><a href="#SiriKit" class="headerlink" title="SiriKit"></a>SiriKit</h3><h5 id="ä»‹ç»-onContinueUserActivity"><a href="#ä»‹ç»-onContinueUserActivity" class="headerlink" title="ä»‹ç» onContinueUserActivity ()"></a>ä»‹ç» onContinueUserActivity ()</h5><p>æˆ‘ä»¬å¯ä»¥ç»™ä¸€ä¸ªåº”ç”¨ä¸­çš„ç‰¹å®šéƒ¨åˆ†å®šä¹‰å¿«æ·æŒ‡ä»¤ã€‚åœ¨ iOS ä¸­ï¼Œè¿™ä¸ªåŠ¨ä½œå¯ä»¥å€ŸåŠ© â€œå¿«æ·æŒ‡ä»¤â€ åº”ç”¨æ¥å®ç°ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨åº”ç”¨å†…é€šè¿‡ä»£ç å®ç°ã€‚UIKit æœ‰ä¸€äº›ä¸“é—¨çš„ UI å…ƒç´ æ¥å¤„ç†è¿™ä»¶äº‹ï¼Œä½† SwiftUI ä¸­å¹¶æ²¡æœ‰ç›´æ¥å¯ç”¨çš„æ–¹æ³•ï¼Œæ‰€ä»¥è¿™ä¸€èŠ‚ä¸­çš„ä¾‹å­ä¼šåŒ…å«ä¸€ä¸ª UIViewControllerRepresentableï¼Œå®ƒçš„ä½œç”¨æ˜¯æä¾›ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»è¿™ä¸ªæŒ‰é’®å¯ä»¥æ‰“å¼€ç³»ç»Ÿçš„æ¨¡æ€è¡¨å•ï¼Œè®©ç”¨æˆ·åˆ›å»ºæˆ–è€…ç¼–è¾‘å¿«æ·æŒ‡ä»¤ã€‚</p>
<p>ä¸€æ—¦å¿«æ·æŒ‡ä»¤åˆ›å»ºï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨ Siri æŒ‡ä»¤æ¥æ‰§è¡Œå®ƒã€‚å®ƒä¼šå¯åŠ¨æˆ–è€…æ¢å¤æˆ‘ä»¬çš„åº”ç”¨ï¼Œå¹¶ä¸”é€šè¿‡ NSUserActivity æä¾›ç”¨æˆ·å¸Œæœ›æˆ‘ä»¬æ‰§è¡Œçš„å¿«æ·æŒ‡ä»¤çš„ç»†èŠ‚ä¿¡æ¯ã€‚SwiftUI å¯¹æ­¤ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª <strong>onContinueUserActivity ()</strong></p>
<p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œé€šè¿‡æŒ‡ä»¤ â€œHey Siri, show random animalâ€ ï¼ˆæˆ–è€…æŸäº›å…¶å®ƒçš„é¢„ç½®æŒ‡ä»¤ï¼‰ï¼Œç³»ç»Ÿä¼šå¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨å¹¶å¯¼èˆªåˆ°æŸä¸ªéšæœºçš„åŠ¨ç‰©è§†å›¾ã€‚</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Intents</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¦è®°å¾—æŠŠä¸‹é¢çš„å£°æ˜æ·»åŠ åˆ° Info.plist æ–‡ä»¶çš„ NSUserActivityTypes æ•°ç»„ä¸­ </span></span><br><span class="line"><span class="keyword">let</span> aType = <span class="string">"com.example.show-animal"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Animal</span>: <span class="title">Identifiable</span> </span>{</span><br><span class="line">    <span class="keyword">let</span> id: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> image: <span class="type">String</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> animals = [<span class="type">Animal</span>(id: <span class="number">1</span>, name: <span class="string">"Lion"</span>, image: <span class="string">"lion"</span>),</span><br><span class="line">               <span class="type">Animal</span>(id: <span class="number">2</span>, name: <span class="string">"Fox"</span>, image: <span class="string">"fox"</span>),</span><br><span class="line">               <span class="type">Animal</span>(id: <span class="number">3</span>, name: <span class="string">"Panda"</span>, image: <span class="string">"panda-bear"</span>),</span><br><span class="line">               <span class="type">Animal</span>(id: <span class="number">4</span>, name: <span class="string">"Elephant"</span>, image: <span class="string">"elephant"</span>)]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> selection: <span class="type">Int?</span> = <span class="literal">nil</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">NavigationView</span> {</span><br><span class="line">            <span class="type">List</span>(animals) { animal <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span>(</span><br><span class="line">                    destination: <span class="type">AnimalDetail</span>(animal: animal),</span><br><span class="line">                    tag: animal.id,</span><br><span class="line">                    selection: $selection,</span><br><span class="line">                    label: { <span class="type">AnimalRow</span>(animal: animal) })</span><br><span class="line">            }</span><br><span class="line">            .navigationTitle (<span class="string">"Animal Gallery"</span>)</span><br><span class="line">            .onContinueUserActivity (aType, perform: { userActivity <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span>.selection = <span class="type">Int</span>.random (<span class="keyword">in</span>: <span class="number">0</span>...(animals.<span class="built_in">count</span> - <span class="number">1</span>))</span><br><span class="line">            })</span><br><span class="line">            </span><br><span class="line">        }.navigationViewStyle (<span class="type">StackNavigationViewStyle</span>())</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AnimalRow</span>: <span class="title">View</span> </span>{</span><br><span class="line">    <span class="keyword">let</span> animal: <span class="type">Animal</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">HStack</span> {</span><br><span class="line">            <span class="type">Image</span>(animal.image)</span><br><span class="line">                .resizable ()</span><br><span class="line">                .frame (width: <span class="number">60</span>, height: <span class="number">60</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">Text</span>(animal.name)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AnimalDetail</span>: <span class="title">View</span> </span>{</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> showAddToSiri: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">let</span> animal: <span class="type">Animal</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> shortcut: <span class="type">INShortcut</span> = {</span><br><span class="line">        <span class="keyword">let</span> activity = <span class="type">NSUserActivity</span>(activityType: aType)</span><br><span class="line">        activity.title = <span class="string">"Display a random animal"</span></span><br><span class="line">        activity.suggestedInvocationPhrase = <span class="string">"Show Random Animal"</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="type">INShortcut</span>(userActivity: activity)</span><br><span class="line">    }()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">VStack</span>(spacing: <span class="number">20</span>) {</span><br><span class="line">            <span class="type">Text</span>(animal.name)</span><br><span class="line">                .font (.title)</span><br><span class="line"></span><br><span class="line">            <span class="type">Image</span>(animal.image)</span><br><span class="line">                .resizable ()</span><br><span class="line">                .scaledToFit ()</span><br><span class="line">            </span><br><span class="line">            <span class="type">SiriButton</span>(shortcut: shortcut).frame (height: <span class="number">34</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸‹é¢æ˜¯ç”¨äºåˆ›å»ºå¿«æ·æŒ‡ä»¤å’Œç¼–è¾‘æ¨¡æ€è¡¨å•çš„ <strong>UIViewControllerRepresentable</strong>ï¼š</p>
<h2 id="-1"><a href="#-1" class="headerlink" title=""></a><figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> IntentsUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SiriButton</span>: <span class="title">UIViewControllerRepresentable</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> shortcut: <span class="type">INShortcut</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeUIViewController</span><span class="params">(context: Context)</span></span> -&gt; <span class="type">SiriUIViewController</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="type">SiriUIViewController</span>(shortcut: shortcut)</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">updateUIViewController</span><span class="params">(<span class="keyword">_</span> uiViewController: SiriUIViewController, context: Context)</span></span> {</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SiriUIViewController</span>: <span class="title">UIViewController</span> </span>{</span><br><span class="line">    <span class="keyword">let</span> shortcut: <span class="type">INShortcut</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(shortcut: <span class="type">INShortcut</span>) {</span><br><span class="line">        <span class="keyword">self</span>.shortcut = shortcut</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(nibName: <span class="literal">nil</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder: <span class="type">NSCoder</span>) {</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"init (coder:) has not been implemented"</span>)</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad ()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> button = <span class="type">INUIAddVoiceShortcutButton</span>(style: .blackOutline)</span><br><span class="line">        button.shortcut = shortcut</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.view.addSubview (button)</span><br><span class="line">        view.centerXAnchor.constraint (equalTo: button.centerXAnchor).isActive = <span class="literal">true</span></span><br><span class="line">        view.centerYAnchor.constraint (equalTo: button.centerYAnchor).isActive = <span class="literal">true</span></span><br><span class="line">        button.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        button.delegate = <span class="keyword">self</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SiriUIViewController</span>: <span class="title">INUIAddVoiceShortcutButtonDelegate</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(<span class="keyword">_</span> addVoiceShortcutViewController: INUIAddVoiceShortcutViewController, <span class="keyword">for</span> addVoiceShortcutButton: INUIAddVoiceShortcutButton)</span></span> {</span><br><span class="line">        addVoiceShortcutViewController.delegate = <span class="keyword">self</span></span><br><span class="line">        addVoiceShortcutViewController.modalPresentationStyle = .formSheet</span><br><span class="line">        present (addVoiceShortcutViewController, animated: <span class="literal">true</span>)</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">present</span><span class="params">(<span class="keyword">_</span> editVoiceShortcutViewController: INUIEditVoiceShortcutViewController, <span class="keyword">for</span> addVoiceShortcutButton: INUIAddVoiceShortcutButton)</span></span> {</span><br><span class="line">        editVoiceShortcutViewController.delegate = <span class="keyword">self</span></span><br><span class="line">        editVoiceShortcutViewController.modalPresentationStyle = .formSheet</span><br><span class="line">        present (editVoiceShortcutViewController, animated: <span class="literal">true</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SiriUIViewController</span>: <span class="title">INUIAddVoiceShortcutViewControllerDelegate</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addVoiceShortcutViewController</span><span class="params">(<span class="keyword">_</span> controller: INUIAddVoiceShortcutViewController, didFinishWith voiceShortcut: INVoiceShortcut?, error: Error?)</span></span> {</span><br><span class="line">        controller.dismiss (animated: <span class="literal">true</span>)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addVoiceShortcutViewControllerDidCancel</span><span class="params">(<span class="keyword">_</span> controller: INUIAddVoiceShortcutViewController)</span></span> {</span><br><span class="line">        controller.dismiss (animated: <span class="literal">true</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SiriUIViewController</span>: <span class="title">INUIEditVoiceShortcutViewControllerDelegate</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">editVoiceShortcutViewController</span><span class="params">(<span class="keyword">_</span> controller: INUIEditVoiceShortcutViewController, didUpdate voiceShortcut: INVoiceShortcut?, error: Error?)</span></span> {</span><br><span class="line">        controller.dismiss (animated: <span class="literal">true</span>)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">editVoiceShortcutViewController</span><span class="params">(<span class="keyword">_</span> controller: INUIEditVoiceShortcutViewController, didDeleteVoiceShortcutWithIdentifier deletedVoiceShortcutIdentifier: UUID)</span></span> {</span><br><span class="line">        controller.dismiss (animated: <span class="literal">true</span>)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">editVoiceShortcutViewControllerDidCancel</span><span class="params">(<span class="keyword">_</span> controller: INUIEditVoiceShortcutViewController)</span></span> {</span><br><span class="line">        controller.dismiss (animated: <span class="literal">true</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></h2><h3 id="Spotlight"><a href="#Spotlight" class="headerlink" title="Spotlight"></a>Spotlight</h3><h5 id="ä»‹ç»-userActivity"><a href="#ä»‹ç»-userActivity" class="headerlink" title="ä»‹ç» userActivity ()"></a>ä»‹ç» userActivity ()</h5><p>Spotlight çš„æœç´¢ç»“æœå¯ä»¥åŒ…å«åº”ç”¨ä¸­çš„é€šç”¨æ´»åŠ¨ã€‚ä¸ºäº†è®© Spotlight å­¦ä¼šä½ çš„æ´»åŠ¨ï¼Œä½ éœ€è¦åœ¨è¿™äº›æ´»åŠ¨å‡ºç°æ—¶å¯¹å¤–å‘å¸ƒï¼Œä»¥ä¾¿ Spotlight å‘ç°å®ƒä»¬ã€‚è¦åœ¨ SwiftUI ä¸­å‘å¸ƒ NSUserActivitiesï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ <strong>userActivity ()</strong> modifierã€‚</p>
<p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå”®å–å†°æ·‡æ·‹çš„åº”ç”¨ã€‚æ¯å½“æˆ‘ä»¬é€‰æ‹©äº†æŸä¸ªå†°æ·‡æ·‹å°ºå¯¸ï¼Œåº”ç”¨å°†å¯¹å¤–å‘å¸ƒå†°æ·‡æ·‹å°ºå¯¸ï¼›æ¯å½“æœ‰ç”¨æˆ·æœç´¢å†°æ·‡æ·‹æ—¶ï¼Œæˆ‘ä»¬çš„åº”ç”¨å°†å‡ºç°åœ¨æœç´¢ç»“æœä¸­ã€‚å¦‚æœç”¨æˆ·é€‰æ‹©äº†æˆ‘ä»¬çš„åº”ç”¨å¯¹äºçš„æœç´¢ç»“æœé¡¹ï¼Œæˆ‘ä»¬çš„åº”ç”¨å°†è¢«è°ƒèµ·ï¼Œå¹¶ä¸”å°†ç”¨æˆ·å¸¦åˆ°æœ€åå…¬å¸ƒçš„å†°æ·‡æ·‹å°ºå¯¸ã€‚</p>
<p>æ³¨æ„ï¼Œç³»ç»Ÿä¼šä¼˜åŒ– <strong>userActivity ()</strong> é—­åŒ…çš„è°ƒç”¨æ—¶æœºã€‚ç„¶è€Œä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸€ç‚¹å¹¶æ²¡æœ‰æ–‡æ¡£è¯´æ˜ã€‚ç³»ç»Ÿå¾ˆèªæ˜ï¼ŒçŸ¥é“è¯¥å¦‚ä½•ä¿å­˜å½“å‰çš„ä¿¡æ¯ï¼Œé¿å…ä¸åœæ›´æ–°ã€‚åœ¨è°ƒè¯•çš„æ—¶å€™ï¼Œå»ºè®®ä½ æœ€å¥½åœ¨ userActivity é—­åŒ…ä¸­åŠ å…¥æ‰“å°è¯­å¥ã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­ä¸­è¿˜åŒ…å«äº†ä¸€ä¸ª â€œForgetâ€ æŒ‰é’®ï¼Œè¿™å¯¹äºè°ƒè¯•ååˆ†æœ‰å¸®åŠ©ã€‚å®ƒä¼šæ¸…é™¤æ‰å·²ç»å‘å¸ƒçš„ç”¨æˆ·æ´»åŠ¨ï¼Œä»¥ä¾¿å°†åº”ç”¨ä» Spotlight çš„æœç´¢ç»“æœä¸­ç§»é™¤ã€‚æ³¨æ„ï¼ŒNSUserActivity æœ‰ä¸€ä¸ªå¯é€‰å±æ€§ï¼š<strong>expirationDate</strong>ï¼Œå¦‚æœå°†å…¶ç½®ä¸º <code>nil</code>ï¼Œåˆ™æ´»åŠ¨æ°¸è¿œä¸ä¼šè¿‡æœŸã€‚</p>
<h2 id="-2"><a href="#-2" class="headerlink" title=""></a><figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Intents</span><br><span class="line"><span class="keyword">import</span> CoreSpotlight</span><br><span class="line"><span class="keyword">import</span> CoreServices</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¦è®°å¾—æŠŠä¸‹é¢çš„å£°æ˜æ·»åŠ åˆ° Info.plist æ–‡ä»¶çš„ NSUserActivityTypes æ•°ç»„ä¸­ </span></span><br><span class="line"><span class="keyword">let</span> aType = <span class="string">"com.example.icecream-selection"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IceCreamSize</span>: <span class="title">Identifiable</span> </span>{</span><br><span class="line">    <span class="keyword">let</span> id: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> price: <span class="type">Float</span></span><br><span class="line">    <span class="keyword">let</span> image: <span class="type">String</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sizes = [</span><br><span class="line">    <span class="type">IceCreamSize</span>(id: <span class="number">1</span>, name: <span class="string">"Small"</span>, price: <span class="number">1.0</span>, image: <span class="string">"small"</span>),</span><br><span class="line">    <span class="type">IceCreamSize</span>(id: <span class="number">2</span>, name: <span class="string">"Medium"</span>, price: <span class="number">1.45</span>, image: <span class="string">"medium"</span>),</span><br><span class="line">    <span class="type">IceCreamSize</span>(id: <span class="number">3</span>, name: <span class="string">"Large"</span>, price: <span class="number">1.9</span>, image: <span class="string">"large"</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> selection: <span class="type">Int?</span> = <span class="literal">nil</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">NavigationView</span> {</span><br><span class="line">            <span class="type">List</span>(sizes) { size <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span>(destination: <span class="type">IceCreamDetail</span>(icecream: size),</span><br><span class="line">                               tag: size.id,</span><br><span class="line">                               selection: $selection,</span><br><span class="line">                               label: { <span class="type">IceCreamRow</span>(icecream: size) })</span><br><span class="line">            }</span><br><span class="line">            .navigationTitle (<span class="string">"Ice Creams"</span>)</span><br><span class="line">            .toolbar {</span><br><span class="line">                <span class="type">Button</span>(<span class="string">"Forget"</span>) {</span><br><span class="line">                    <span class="type">NSUserActivity</span>.deleteAllSavedUserActivities {</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">"done!"</span>)</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">        }</span><br><span class="line">        .onContinueUserActivity (aType, perform: { userActivity <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> icecreamId = userActivity.userInfo?[<span class="string">"sizeId"</span>] <span class="keyword">as</span>? <span class="type">NSNumber</span> {</span><br><span class="line">                selection = icecreamId.intValue</span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line">        })</span><br><span class="line">        .navigationViewStyle (<span class="type">StackNavigationViewStyle</span>())</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IceCreamRow</span>: <span class="title">View</span> </span>{</span><br><span class="line">    <span class="keyword">let</span> icecream: <span class="type">IceCreamSize</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">HStack</span> {</span><br><span class="line">            <span class="type">Image</span>(icecream.image)</span><br><span class="line">                .resizable ()</span><br><span class="line">                .frame (width: <span class="number">80</span>, height: <span class="number">80</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) {</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"\(icecream.name)"</span>).font (.title).fontWeight (.bold)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"$ \(String (format: "</span>%<span class="number">0</span>.2f<span class="string">", icecream.price))"</span>).font (.subheadline)</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IceCreamDetail</span>: <span class="title">View</span> </span>{</span><br><span class="line">    <span class="keyword">let</span> icecream: <span class="type">IceCreamSize</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">VStack</span> {</span><br><span class="line">            <span class="type">Text</span>(<span class="string">"\(icecream.name)"</span>).font (.title).fontWeight (.bold)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">"$ \(String (format: "</span>%<span class="number">0</span>.2f<span class="string">", icecream.price))"</span>).font (.subheadline)</span><br><span class="line"></span><br><span class="line">            <span class="type">Image</span>(icecream.image)</span><br><span class="line">                .resizable ()</span><br><span class="line">                .scaledToFit ()</span><br><span class="line">            </span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        }</span><br><span class="line">        .userActivity (aType) { userActivity <span class="keyword">in</span></span><br><span class="line">            userActivity.isEligibleForSearch = <span class="literal">true</span></span><br><span class="line">            userActivity.title = <span class="string">"\(icecream.name) Ice Cream"</span></span><br><span class="line">            userActivity.userInfo = [<span class="string">"sizeId"</span>: icecream.id]</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> attributes = <span class="type">CSSearchableItemAttributeSet</span>(itemContentType: kUTTypeItem <span class="keyword">as</span> <span class="type">String</span>)</span><br><span class="line">            </span><br><span class="line">            attributes.contentDescription = <span class="string">"Get a delicious ice cream now!"</span></span><br><span class="line">            attributes.thumbnailData = <span class="type">UIImage</span>(named: icecream.image)?.pngData ()</span><br><span class="line">            userActivity.contentAttributeSet = attributes</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Advertising: \(icecream.name)"</span>)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></h2><h3 id="Handoff-æ¥åŠ›"><a href="#Handoff-æ¥åŠ›" class="headerlink" title="Handoff - æ¥åŠ›"></a>Handoff - æ¥åŠ›</h3><p>åŸºäºå·²ç»ä»‹ç»çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¥åŠ›åº”ç”¨äº†ã€‚è¿™å°†æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨å¦å¤–çš„è®¾å¤‡ä¸Šæ¥åŠ›å·¥ä½œçš„åº”ç”¨ã€‚ä¸¤ä¸ªè®¾å¤‡ä¸Šçš„åº”ç”¨å¯ä»¥æ˜¯åŒä¸€ä¸ªåº”ç”¨æˆ–è€…ä¸åŒçš„åº”ç”¨ã€‚è¿™ç§æƒ…å†µé€šå¸¸å‘ç”Ÿåœ¨æˆ‘ä»¬åˆ†å‘äº†åº”ç”¨çš„ä¸¤ä¸ªä¸åŒç‰ˆæœ¬çš„æ—¶å€™ï¼šæ¯”å¦‚ä¸€ä¸ªæ˜¯ iOS ç‰ˆæœ¬ï¼Œå¦ä¸€ä¸ªæ˜¯ macOS ç‰ˆæœ¬ã€‚</p>
<p>ä¸ºäº†è®©æ¥åŠ›èƒ½å¤Ÿå·¥ä½œï¼Œç›¸å…³çš„åº”ç”¨éƒ½éœ€è¦æ³¨å†Œåœ¨åŒä¸€ä¸ªå¼€å‘è€…å›¢é˜Ÿçš„æ ‡è¯†ä¸‹é¢ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å‚ä¸çš„åº”ç”¨çš„ Info.plist ä¸­é…ç½® <strong>NSUserActivityTypes</strong> å®ä½“ã€‚</p>
<p>æœ‰å…³äºæ¥åŠ›çš„æ›´å¤šå®ç°ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒ Apple çš„ <a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/Handoff/AdoptingHandoff/AdoptingHandoff.html">ç½‘ç«™</a>ã€‚</p>
<p>ä¸‹é¢çš„ç¤ºä¾‹å®ç°äº†ä¸€ä¸ªç®€å•çš„ web æµè§ˆå™¨ï¼Œé€šè¿‡è°ƒç”¨ <strong>userActivity ()</strong> å‘å¸ƒç”¨æˆ·æ­£åœ¨æµè§ˆçš„é¡µé¢ä»¥åŠä»–åœ¨é¡µé¢ä¸Šæ»šåŠ¨çš„ä½ç½®ã€‚</p>
<p>å‡å¦‚ç”¨æˆ·åˆ‡æ¢åˆ°äº†å¦ä¸€ä¸ªè®¾å¤‡ï¼Œå½“åŒä¸€ä¸ªåº”ç”¨è¢«è°ƒèµ·æˆ–è€…æ¢å¤æ—¶ï¼Œ<strong>onContinueUserActivity ()</strong> é—­åŒ…å°†è¢«è°ƒç”¨ï¼Œåº”ç”¨å¯ä»¥å€Ÿæ­¤æ‰“å¼€åŒä¸€ä¸ªé¡µé¢ï¼Œå¹¶ä¸”æ»šåŠ¨åˆ°ä»–åœ¨ä¹‹å‰è®¾å¤‡ä¸Šæµè§ˆåˆ°çš„é¡µé¢ä½ç½®ã€‚</p>
<p>ç”¨æˆ·æ´»åŠ¨å¯ä»¥é€šè¿‡ userInfo å­—å…¸çš„å½¢å¼æä¾›è´Ÿè½½æ•°æ®ï¼Œå®ƒæ˜¯æˆ‘ä»¬å­˜æ”¾ç‰¹å®šäºæ¥åŠ›æ´»åŠ¨ä¿¡æ¯çš„åœ°æ–¹ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå³é¡µé¢æ»šåŠ¨ä½ç½®ï¼ˆç™¾åˆ†æ¯”ï¼‰å’Œæ‰€æ‰“å¼€é¡µé¢çš„ URLã€‚æ­¤å¤–ï¼Œè¿˜åŒ…å«äº†å‘å¸ƒæ­¤æ´»åŠ¨çš„åº”ç”¨çš„ bundle idï¼Œå®ƒåªæ˜¯ç”¨æ¥è°ƒè¯•çš„ä¿¡æ¯ï¼Œä¾¿äºæˆ‘ä»¬å‡†ç¡®åœ°çŸ¥é“å‘ç”Ÿçš„äº‹æƒ…ã€‚</p>
<p>æ³¨æ„ï¼Œç¤ºä¾‹çš„ä»£ç åœ¨ iOS å’Œ macOS ä¸Šéƒ½èƒ½å·¥ä½œï¼Œè¿™æ˜¯ä¸ºäº†è®©ä½ èƒ½å¤ŸåŒæ—¶åˆ›å»ºä¸¤ä¸ªåº”ç”¨ï¼Œå¹¶ä¸”æµ‹è¯• iOS è®¾å¤‡å’Œ Mac è®¾å¤‡ä¹‹é—´çš„æ¥åŠ›ã€‚</p>
<p>æœ€åï¼Œè™½ç„¶è·Ÿ NSUserActivity æ— å…³ï¼Œè¿™ä¸ªç¤ºä¾‹è¿˜å°è£…äº†ä¸€ä¸ª WKWebViewï¼Œè¿™æ˜¯æ¼”ç¤º javascript äº‹ä»¶ï¼ˆè¿™ä¸ªç¤ºä¾‹ä¸­çš„ <code>onScroll</code>ï¼‰å¦‚ä½•æ›´æ–°ä½ çš„ SwiftUI è§†å›¾ç»‘å®šçš„ç»ä½³ç¤ºä¾‹ã€‚å®Œæ•´çš„ WebView ä»£ç å¯ä»¥ä»ä¸‹é¢çš„ gist æ–‡ä»¶æ‰¾åˆ°ï¼š<a target="_blank" rel="noopener" href="https://gist.github.com/swiftui-lab/a873bf413770db6fd1a525fa424ce8cd">WebView.swift</a></p>
<h2 id="-3"><a href="#-3" class="headerlink" title=""></a><figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¦è®°å¾—æŠŠä¸‹é¢çš„å£°æ˜æ·»åŠ åˆ° Info.plist æ–‡ä»¶çš„ NSUserActivityTypes æ•°ç»„ä¸­ </span></span><br><span class="line"><span class="keyword">let</span> activityType = <span class="string">"com.example.openpage"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    @<span class="type">StateObject</span> <span class="keyword">var</span> data = <span class="type">WebViewData</span>()</span><br><span class="line">    </span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> reload: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">VStack</span> {</span><br><span class="line">            <span class="type">HStack</span> {</span><br><span class="line">                <span class="type">TextField</span>(<span class="string">""</span>, text: $data.urlBar, onCommit: { <span class="keyword">self</span>.loadUrl (data.urlBar) })</span><br><span class="line">                    .textFieldStyle (<span class="type">RoundedBorderTextFieldStyle</span>())</span><br><span class="line">                    .disableAutocorrection (<span class="literal">true</span>)</span><br><span class="line">                    .modifier (<span class="type">KeyboardModifier</span>())</span><br><span class="line">                    .frame (maxWidth: .infinity)</span><br><span class="line">                    .overlay (<span class="type">ProgressView</span>().opacity (<span class="keyword">self</span>.data.loading ? <span class="number">1</span> : <span class="number">0</span>).scaleEffect (<span class="number">0.5</span>), alignment: .trailing)</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">                <span class="type">Button</span>(action: {</span><br><span class="line">                    <span class="keyword">self</span>.data.scrollOnLoad = <span class="keyword">self</span>.data.scrollPercent</span><br><span class="line">                    <span class="keyword">self</span>.reload.toggle ()</span><br><span class="line">                }, label: { <span class="type">Image</span>(systemName: <span class="string">"arrow.clockwise"</span>) })</span><br><span class="line">                </span><br><span class="line">                <span class="type">Button</span>(<span class="string">"Go"</span>) {</span><br><span class="line">                    <span class="keyword">self</span>.loadUrl (data.urlBar)</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            .padding (.horizontal, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">Text</span>(<span class="string">"\(data.scrollPercent)"</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">WebView</span>(data: data)</span><br><span class="line">                .id (reload)</span><br><span class="line">                .onAppear { loadUrl (data.urlBar) }</span><br><span class="line">        }</span><br><span class="line">        .userActivity (activityType, element: data.url) { url, activity <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> bundleid = <span class="type">Bundle</span>.main.bundleIdentifier ?? <span class="string">""</span></span><br><span class="line">            </span><br><span class="line">            activity.addUserInfoEntries (from: [<span class="string">"scrollPercent"</span>: data.scrollPercent,</span><br><span class="line">                                               <span class="string">"page"</span>: data.url?.absoluteString ?? <span class="string">""</span>,</span><br><span class="line">                                               <span class="string">"setby"</span>: bundleid])</span><br><span class="line">            </span><br><span class="line">            logUserActivity (activity, label: <span class="string">"activity"</span>)</span><br><span class="line">        }</span><br><span class="line">        .onContinueUserActivity (activityType, perform: { userActivity <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> page = userActivity.userInfo?[<span class="string">"page"</span>] <span class="keyword">as</span>? <span class="type">String</span> {</span><br><span class="line">                <span class="comment">// Load handoff page</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">self</span>.data.url?.absoluteString != page {</span><br><span class="line">                    <span class="keyword">self</span>.data.url = <span class="type">URL</span>(string: page)</span><br><span class="line">                }</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Restore handoff scroll position</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> scrollPercent = userActivity.userInfo?[<span class="string">"scrollPercent"</span>] <span class="keyword">as</span>? <span class="type">Float</span> {</span><br><span class="line">                    <span class="keyword">self</span>.data.scrollOnLoad = scrollPercent</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">            logUserActivity (userActivity, label: <span class="string">"on activity"</span>)</span><br><span class="line">        })</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadUrl</span><span class="params">(<span class="keyword">_</span> string: String)</span></span> {</span><br><span class="line">        <span class="keyword">if</span> string.hasPrefix (<span class="string">"http"</span>) {</span><br><span class="line">            <span class="keyword">self</span>.data.url = <span class="type">URL</span>(string: string)</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">self</span>.data.url = <span class="type">URL</span>(string: <span class="string">"https://"</span> + string)</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.data.urlBar = <span class="keyword">self</span>.data.url?.absoluteString ?? string</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">logUserActivity</span><span class="params">(<span class="keyword">_</span> activity: NSUserActivity, label: String = <span class="string">""</span>)</span></span> {</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\(label) TYPE = \(activity.activityType)"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\(label) INFO = \(activity.userInfo ?? [:])"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">KeyboardModifier</span>: <span class="title">ViewModifier</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">body</span><span class="params">(content: Content)</span></span> -&gt; <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="keyword">#if</span> os (iOS)</span><br><span class="line">            <span class="keyword">return</span> content</span><br><span class="line">                .keyboardType (.<span class="type">URL</span>)</span><br><span class="line">                .textContentType (.<span class="type">URL</span>)</span><br><span class="line">        <span class="keyword">#else</span></span><br><span class="line">            <span class="keyword">return</span> content</span><br><span class="line">        <span class="keyword">#endif</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></h2><h3 id="Scene-é€‰æ‹©"><a href="#Scene-é€‰æ‹©" class="headerlink" title="Scene é€‰æ‹©"></a>Scene é€‰æ‹©</h3><h5 id="ä»‹ç»-handlesExternalEvents"><a href="#ä»‹ç»-handlesExternalEvents" class="headerlink" title="ä»‹ç» handlesExternalEvents ()"></a>ä»‹ç» handlesExternalEvents ()</h5><p>å½“ç³»ç»Ÿå¯åŠ¨æˆ–è€…æ¢å¤æˆ‘ä»¬çš„åº”ç”¨çš„æ—¶å€™ï¼Œå®ƒå¿…é¡»ç¡®å®šå“ªä¸ª scene èƒ½å¤Ÿæ¥å—åˆ°ç”¨æˆ·æ´»åŠ¨ï¼ˆæŸä¸€ä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªèƒ½æ¥æ”¶åˆ°ï¼‰ã€‚ä¸ºäº†å¸®åŠ©å®ƒåšå‡ºè¿™ä¸ªå†³ç­–ï¼Œæˆ‘ä»¬çš„åº”ç”¨å¯ä»¥ç”¨ä¸Š <strong>handlesExternalEvents ()</strong> æ–¹æ³•ã€‚ä¸å¹¸è¿æ˜¯ï¼Œå†™è¿™ç¯‡æ–‡æ¡£çš„æ—¶å€™ (Xcode 12, beta 6)ï¼Œè¿™ä¸ªæ–¹æ³•è²Œä¼¼ä¸èµ·ä½œç”¨ï¼Œè€Œä¸” macOS ä¸Šè™½ç„¶æœ‰æ”¯æŒï¼Œä½†ç¼ºå°‘å¹³å°å®šä¹‰æ–‡ä»¶ã€‚</p>
<p>æ‰€ä»¥æˆ‘è¿™é‡Œå°†é€šè¿‡æ³¨é‡Šæ¥è¯´æ˜å®ƒçš„å·¥ä½œæ–¹å¼ï¼Œç­‰å°†æ¥çœŸæ­£å¯ç”¨æ—¶ï¼Œæˆ‘ä¼šæ›´æ–°è¿™ç¯‡æ–‡ç« ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•æœ‰ä¸¤ä¸ªç‰ˆæœ¬ã€‚ä¸€ä¸ªç”¨äº WindowGroup åœºæ™¯ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handlesExternalEvents</span><span class="params">(matching conditions: Set&lt;String&gt;)</span></span> -&gt; <span class="keyword">some</span> <span class="type">Scene</span></span><br></pre></td></tr></tbody></table></figure>
<p>å¦ä¸€ä¸ªç”¨äºè§†å›¾ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handlesExternalEvents</span><span class="params">(preferring: Set&lt;String&gt;, allowing: Set&lt;String&gt;)</span></span> -&gt; <span class="keyword">some</span> <span class="type">View</span></span><br></pre></td></tr></tbody></table></figure>
<p>ä¸¤ç§ç‰ˆæœ¬ä¸­æˆ‘ä»¬éƒ½ä¼šæŒ‡å®šä¸€ä¸ªå­—ç¬¦ä¸² <code>Set</code>ï¼Œç³»ç»Ÿç”¨å®ƒæ¥è·Ÿ NSUserActivity çš„ <strong>targetContentIdentifier</strong> å±æ€§åšæ¯”å¯¹ã€‚å‡å¦‚æ‰¾åˆ°åŒ¹é…é¡¹ï¼Œå¯¹åº”çš„ scene ä¼šè¢«é€‰ç”¨ã€‚å¦‚æœä¸æŒ‡å®šè¿™ä¸ª <code>Set</code>ï¼Œæˆ–è€…æ²¡æœ‰æ‰¾åˆ°åŒ¹é…é¡¹ï¼Œåˆ™å®é™…è¡Œä¸ºç”±å…·ä½“å¹³å°å†³å®šã€‚ä¾‹å¦‚ï¼Œåœ¨ iPadOS ä¸Šä¼šé€‰æ‹©ä¸€ä¸ªå·²ç»ç°æœ‰çš„ sceneï¼Œè€Œåœ¨ macOS ä¸Šï¼Œæ–°çš„ scene ä¼šè¢«åˆ›å»ºã€‚</p>
<p>åœ¨åªæ”¯æŒä¸€ä¸ª scene çš„ç³»ç»Ÿä¸Šï¼Œè¿™ä¸ªæ–¹æ³•å°†è¢«å¿½ç•¥ã€‚</p>
<p>æ³¨æ„ï¼Œ<strong>targetContentIdentifier</strong> åœ¨ <strong>UNNotificationContent</strong> å’Œ <strong>UIApplicationShortcutItem</strong> ä¸­ä¹Ÿæœ‰æä¾›ï¼Œå› æ­¤ <strong>handlesExternalEvents ()</strong> å¤§æ¦‚ç‡ä¹Ÿä¼šæ”¯æŒå®ƒä»¬ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Apple å…³äº NSUserActivity çš„æ–‡æ¡£èµ„æ–™éå¸¸å¤šï¼Œæ‰€ä»¥æˆ‘å»ºè®®ä½ å»æŸ¥é˜…è¿™äº›æ–‡æ¡£ã€‚ä½†ç›®å‰ ç¼ºå°‘ SwiftUI çš„ç¤ºä¾‹ã€‚è¿™ç¯‡æ–‡ç« çš„ç›®çš„å°±æ˜¯ä¸ºä½ æä¾›ä¸€äº›åœ¨ SwiftUI ä¸­å®è·µ NSUserActivity çš„å¯åŠ¨ä»£ç ã€‚</p>
<hr>
<p>å°é¢æ¥è‡ª <a target="_blank" rel="noopener" href="https://unsplash.com/@chewy?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Chewy</a> on <a target="_blank" rel="noopener" href="https://unsplash.com/s/photos/nature?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://theinfinitegame.tech/programming/whats-new-in-swift-5-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="çŒ«å…‹æ¯">
      <meta itemprop="description" content="Stay hungry, stay foolish.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="The Infinite Game">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/programming/whats-new-in-swift-5-3/" class="post-title-link" itemprop="url">Swift 5.3 æ–°ç‰¹æ€§</a>
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-07-19 16:34:44" itemprop="dateCreated datePublished" datetime="2020-07-19T16:34:44+08:00">2020-07-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>6.1k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>6 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggwdc1o5lmj315o0rswg0.jpg" alt="swift-evolution-4"></p>
<p>æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ã€ŒSwift èŠ±å›­ã€</p>
<p>Swift 5.3 æœ‰ä¸å°‘å˜åŒ–ï¼Œè¿™å…¶ä¸­åŒ…æ‹¬å¤šæ¨¡å¼ catch è¯­å¥ï¼Œå¤šæ‹–å°¾é—­åŒ…ï¼Œä»¥åŠ Swift Package Manager çš„ä¸€äº›é‡è¦æ”¹å˜ã€‚</p>
<p>æœ¬æ–‡ä¼šå¸¦ä½ æµè§ˆä¸€äº›ä¸»è¦çš„å˜åŒ–ï¼ŒåŒæ—¶æä¾›å‚è€ƒä»£ç ï¼Œä»¥ä¾¿ä½ å¯ä»¥è‡ªè¡Œå°è¯•ã€‚ä»¥ä¸‹æ˜¯è¦ä»‹ç»çš„æ–°ç‰¹æ€§çš„æ¸…å•ï¼š</p>
<ul>
<li>å¤šæ¨¡å¼ catch è¯­å¥</li>
<li>å¤šæ‹–å°¾é—­åŒ…</li>
<li>ä¸ºæšä¸¾è‡ªåŠ¨ç”Ÿæˆçš„ Comparable å®ç°</li>
<li>self. ä¹¦å†™çœç•¥</li>
<li>åŸºäºç±»å‹çš„ç¨‹åºå…¥å£</li>
<li>åŸºäºä¸Šä¸‹æ–‡æ³›å‹å£°æ˜çš„ <code>where</code> è¯­å¥</li>
<li>æšä¸¾çš„ cases å¯ä»¥ä½œä¸º protocol witnesses</li>
<li>é‡æ–°æç‚¼çš„ <code>didSet</code> è¯­ä¹‰</li>
<li>æ–°çš„ Float16 ç±»å‹</li>
<li>Swift Package Manager æ”¯æŒäºŒè¿›åˆ¶ä¾èµ–ï¼Œèµ„æºç­‰æ›´å¤šç±»å‹</li>
</ul>
<h3 id="å¤šæ¨¡å¼-catch-è¯­å¥"><a href="#å¤šæ¨¡å¼-catch-è¯­å¥" class="headerlink" title="å¤šæ¨¡å¼ catch è¯­å¥"></a>å¤šæ¨¡å¼ catch è¯­å¥</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0276-multi-pattern-catch-clauses.md">SE-0276</a> å¼•å…¥äº†ä¸€ä¸ªå¯ä»¥åœ¨å•ä¸ª <code>catch</code> å—ä¸­æ•è·å¤šä¸ªé”™è¯¯ case çš„ç‰¹æ€§ï¼Œè¿™èƒ½è®©æˆ‘ä»¬å…é™¤é”™è¯¯å¤„ç†æ—¶çš„é‡å¤ä»£ç ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ç”¨æšä¸¾å®šä¹‰äº†é”™è¯¯çš„ä¸¤ç§æƒ…å†µï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">TemperatureError</span>: <span class="title">Error</span> </span>{</span><br><span class="line">    <span class="keyword">case</span> tooCold, tooHot</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å½“æˆ‘ä»¬è¯»å–åˆ°æ¸©åº¦æ—¶ï¼Œæ—¢å¯ä»¥æŠ›å‡ºä¸¤ç§é”™è¯¯ä¸­çš„æŸä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥è¿”å› â€œOKâ€ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getReactorTemperature</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> {</span><br><span class="line">    <span class="number">90</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">checkReactorOperational</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">String</span> {</span><br><span class="line">    <span class="keyword">let</span> temp = getReactorTemperature ()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> temp &lt; <span class="number">10</span> {</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">TemperatureError</span>.tooCold</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> temp &gt; <span class="number">90</span> {</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">TemperatureError</span>.tooHot</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"OK"</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>åœ¨æ•è·é”™è¯¯çš„ç¯èŠ‚ï¼ŒSE-0276 å…è®¸æˆ‘ä»¬ç”¨é€—å·åˆ†éš”æ¥è¡¨ç¤ºæˆ‘ä»¬è¦ä»¥ç›¸åŒæ–¹å¼å¤„ç†  <code>tooHot</code> å’Œ <code>tooCold</code>ã€‚</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> {</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">try</span> checkReactorOperational ()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">" ç»“æœ: \(result)"</span>)</span><br><span class="line">} <span class="keyword">catch</span> <span class="type">TemperatureError</span>.tooHot, <span class="type">TemperatureError</span>.tooCold {</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">" å…³é—­ååº”å † &amp; quot;</span>)</span><br><span class="line">} <span class="keyword">catch</span> {</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">" æœªçŸ¥é”™è¯¯ &amp; quot;</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å¤„ç†çš„ case å¯ä»¥æ˜¯ä»»æ„æ•°é‡çš„ã€‚</p>
<h3 id="å¤šæ‹–å°¾é—­åŒ…"><a href="#å¤šæ‹–å°¾é—­åŒ…" class="headerlink" title="å¤šæ‹–å°¾é—­åŒ…"></a>å¤šæ‹–å°¾é—­åŒ…</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0279-multiple-trailing-closures.md">SE-0279</a> å¼•å…¥äº†å¤šæ‹–å°¾é—­åŒ…ï¼Œè¿™ä½¿å¾—è°ƒç”¨åŒ…å«å¤šä¸ªé—­åŒ…çš„å‡½æ•°å¯ä»¥æ›´ç®€å•åœ°å®ç°ã€‚</p>
<p>è¿™ä¸ªç‰¹æ€§åœ¨ SwiftUI ä¸­éå¸¸å—æ¬¢è¿ã€‚åŸæ¥å½¢å¦‚ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">OldContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> showOptions = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">Button</span>(action: {</span><br><span class="line">            <span class="keyword">self</span>.showOptions.toggle ()</span><br><span class="line">        }) {</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">"gear"</span>)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å¯ä»¥è¢«æ”¹å†™æˆï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NewContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> showOptions = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">Button</span> {</span><br><span class="line">            <span class="keyword">self</span>.showOptions.toggle ()</span><br><span class="line">        } label: {</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">"gear"</span>)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ç†è®ºä¸Šå¹¶ä¸è¦æ±‚ <code>label:</code> è¦è·Ÿåœ¨å‰ä¸€ä¸ªé—­åŒ…çš„ <code>}</code> åé¢ï¼Œæ‰€ä»¥ä½ ç”šè‡³å¯ä»¥åƒä¸‹é¢è¿™æ ·ä¹¦å†™ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BadContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> showOptions = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">Button</span> {</span><br><span class="line">            <span class="keyword">self</span>.showOptions.toggle ()</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        label: {</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">"gear"</span>)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸è¿‡ï¼Œæˆ‘ä¼šå»ºè®®ä½ å½“å¿ƒä»£ç çš„å¯è¯»æ€§ â€”â€” åƒä¸Šé¢çš„ <code>label</code> é‚£æ ·çš„ä»£ç å—ï¼Œåœ¨ Swift é‡Œçœ‹èµ·æ¥æ›´åƒæ˜¯æ ‡ç­¾åŒ–çš„ä»£ç å—ï¼Œè€Œä¸æ˜¯ <code>Button</code> æ„é€ å™¨çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<p><strong> æ³¨ï¼š</strong> æœ‰å…³ Swift çš„å¤šæ‹–å°¾é—­åŒ…ç‰¹æ€§çš„è®¨è®ºéå¸¸çƒ­çƒˆã€‚æˆ‘æƒ³æé†’å¤§å®¶çš„æ˜¯ï¼Œåƒè¿™ç§ç±»å‹çš„è¯­æ³•å˜åŠ¨ä¸€å¼€å§‹çœ‹èµ·æ¥å¯èƒ½ä¼šæœ‰ç‚¹åˆ«æ‰­ï¼Œæˆ‘ä»¬éœ€è¦è€å¿ƒï¼Œç»™å®ƒæ—¶é—´ï¼Œåœ¨å®è·µä¸­ä½“ä¼šå®ƒå¸¦æ¥çš„ç»“æœã€‚</p>
<h3 id="ä¸ºæšä¸¾è‡ªåŠ¨ç”Ÿæˆçš„-Comparable-å®ç°"><a href="#ä¸ºæšä¸¾è‡ªåŠ¨ç”Ÿæˆçš„-Comparable-å®ç°" class="headerlink" title="ä¸ºæšä¸¾è‡ªåŠ¨ç”Ÿæˆçš„ Comparable å®ç°"></a>ä¸ºæšä¸¾è‡ªåŠ¨ç”Ÿæˆçš„ Comparable å®ç°</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0266-synthesized-comparable-for-enumerations.md">SE-0266</a> ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä¸ºæšä¸¾ç”Ÿæˆ <code>Comparable</code> å®ç°ï¼ŒåŒæ—¶ä¸è¦æ±‚æˆ‘ä»¬å£°æ˜å…³è”å€¼ï¼Œæˆ–è€…è¦æ±‚å…³è”å€¼æœ¬èº«å¿…é¡»æ˜¯ <code>Comparable</code> çš„ã€‚è¿™ä¸ªç‰¹æ€§è®©æˆ‘ä»¬å¯ä»¥åœ¨åŒç±»å‹çš„æšä¸¾ä¹‹é—´ç”¨ <code>&lt;</code>ï¼Œ<code>&gt;</code> å’Œç±»ä¼¼çš„æ¯”è¾ƒæ“ä½œç¬¦æ¥è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæšä¸¾ï¼Œå®ƒæè¿°äº†è¡£æœçš„å°ºå¯¸ï¼Œæˆ‘ä»¬å¯ä»¥è¦æ±‚ Swift ä¸ºå®ƒè‡ªåŠ¨ç”Ÿæˆ <code>Comparable</code> å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Size</span>: <span class="title">Comparable</span> </span>{</span><br><span class="line">    <span class="keyword">case</span> small</span><br><span class="line">    <span class="keyword">case</span> medium</span><br><span class="line">    <span class="keyword">case</span> large</span><br><span class="line">    <span class="keyword">case</span> extraLarge</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸¤ä¸ªè¿™ä¸ªæšä¸¾çš„å®ä¾‹ï¼Œå¹¶ä¸”ç”¨ <code>&lt;</code> è¿›è¡Œæ¯”è¾ƒï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> shirtSize = <span class="type">Size</span>.small</span><br><span class="line"><span class="keyword">let</span> personSize = <span class="type">Size</span>.large</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> shirtSize &lt; personSize {</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"T æ¤ å¤ªå°äº†ï¼"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è‡ªåŠ¨ç”Ÿæˆçš„å®ç°ï¼Œä¹Ÿèƒ½å¾ˆå¥½åœ°é€‚åº”æšä¸¾çš„ <code>Comparable</code> å…³è”å€¼ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæšä¸¾ï¼Œæè¿°äº†æŸä¸ªé˜Ÿä¼è·å–ä¸–ç•Œæ¯å† å†›çš„æ¬¡æ•°ï¼Œä»£ç å¯ä»¥è¿™æ ·å®ç°ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">WorldCupResult</span>: <span class="title">Comparable</span> </span>{</span><br><span class="line">    <span class="keyword">case</span> neverWon</span><br><span class="line">    <span class="keyword">case</span> winner (stars: <span class="type">Int</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ç„¶åæˆ‘ä»¬ç”¨ä¸åŒçš„å€¼æ¥åˆ›å»ºæšä¸¾çš„ä¸åŒå®ä¾‹ï¼Œå¹¶ä¸”è®© Swift å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> americanMen = <span class="type">WorldCupResult</span>.neverWon</span><br><span class="line"><span class="keyword">let</span> americanWomen = <span class="type">WorldCupResult</span>.winner (stars: <span class="number">4</span>)</span><br><span class="line"><span class="keyword">let</span> japaneseMen = <span class="type">WorldCupResult</span>.neverWon</span><br><span class="line"><span class="keyword">let</span> japaneseWomen = <span class="type">WorldCupResult</span>.winner (stars: <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> teams = [americanMen, americanWomen, japaneseMen, japaneseWomen]</span><br><span class="line"><span class="keyword">let</span> sortedByWins = teams.sorted ()</span><br><span class="line"><span class="built_in">print</span>(sortedByWins)</span><br></pre></td></tr></tbody></table></figure>
<p>æ’åºè¿‡ç¨‹ä¼šæŠŠæœªè·å¾—ä¸–ç•Œæ¯å† å†›çš„é˜Ÿä¼æ”¾åœ¨å‰é¢ï¼Œç„¶åæ˜¯æ—¥æœ¬å¥³å­é˜Ÿï¼Œå†ç„¶åæ˜¯ç¾å›½å¥³å­é˜Ÿ â€”â€” ä¸¤ç»„ <code>winner</code> çš„é˜Ÿè¢«è®¤ä¸ºæ˜¯å¤§äºä¸¤ç»„ <code>neverWon</code> çš„é˜Ÿï¼Œè€Œ <code>winner (stars: 4)</code> è¢«è®¤ä¸ºæ˜¯å¤§äº <code>winner (stars: 1)</code>ã€‚</p>
<h3 id="self-ä¹¦å†™çœç•¥"><a href="#self-ä¹¦å†™çœç•¥" class="headerlink" title="self. ä¹¦å†™çœç•¥"></a>self. ä¹¦å†™çœç•¥</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0269-implicit-self-explicit-capture.md">SE-0269</a> ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ä¸€äº›ä¸å¿…è¦çš„åœ°æ–¹çœç•¥ <code>self</code> ã€‚åœ¨è¿™ä¸ªæ”¹å˜ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ‰€æœ‰çš„é—­åŒ…å½“ä¸­å¯¹å¼•ç”¨ <code>self</code> çš„å±æ€§æˆ–è€…æ–¹æ³•å† ä»¥ <code>self.</code>ï¼Œä»¥ä¾¿æ˜¾å¼åœ°æ˜ç¡®è¯­ä¹‰ã€‚ä½†æœ‰çš„æ—¶å€™ç”±äºé—­åŒ…ä¸å¯èƒ½äº§ç”Ÿå¼•ç”¨å¾ªç¯ï¼Œ<code>self</code> æ˜¯å¤šä½™çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¹‹å‰æˆ‘ä»¬éœ€è¦æŠŠä»£ç å†™æˆä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">OldContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">List</span>(<span class="number">1</span>..&lt;<span class="number">5</span>) { number <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.cell (<span class="keyword">for</span>: number)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">cell</span><span class="params">(<span class="keyword">for</span> number: Int)</span></span> -&gt; <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">Text</span>(<span class="string">"Cell \(number)"</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å¯¹ <code>self.cell (for:)</code> çš„è°ƒç”¨ä¸ä¼šäº§ç”Ÿå¼•ç”¨å¾ªç¯ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨ç»“æ„ä½“å†…ä½¿ç”¨ã€‚å¤šäºäº† SE-0269ï¼Œä¸Šé¢çš„ä»£ç ç°åœ¨å¯ä»¥å…å» <code>self.</code>ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NewContentView</span>: <span class="title">View</span> </span>{</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">List</span>(<span class="number">1</span>..&lt;<span class="number">5</span>) { number <span class="keyword">in</span></span><br><span class="line">            cell (<span class="keyword">for</span>: number)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">cell</span><span class="params">(<span class="keyword">for</span> number: Int)</span></span> -&gt; <span class="keyword">some</span> <span class="type">View</span> {</span><br><span class="line">        <span class="type">Text</span>(<span class="string">"Cell \(number)"</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™ä¸ªç‰¹æ€§å¯¹äºå¤§é‡ä½¿ç”¨é—­åŒ…çš„æ¡†æ¶éå¸¸æœ‰ç”¨ï¼ŒåŒ…æ‹¬ SwiftUI å’Œ Combineã€‚</p>
<h3 id="åŸºäºç±»å‹çš„ç¨‹åºå…¥å£"><a href="#åŸºäºç±»å‹çš„ç¨‹åºå…¥å£" class="headerlink" title="åŸºäºç±»å‹çš„ç¨‹åºå…¥å£"></a>åŸºäºç±»å‹çš„ç¨‹åºå…¥å£</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0281-main-attribute.md">SE-0281</a> å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ <code>@main</code> å±æ€§ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬å£°æ˜ç¨‹åºçš„å…¥å£ã€‚è¿™ä¸ªç‰¹æ€§ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç²¾ç¡®åœ°æ§åˆ¶ç¨‹åºå¯åŠ¨æ—¶è¦æ‰§è¡Œçš„ä»£ç ï¼Œå¯¹äºå‘½ä»¤è¡Œç¨‹åºå°¤å…¶æœ‰å¸®åŠ©ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç»ˆç«¯åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªå« main.swift çš„æ–‡ä»¶ï¼Œç„¶åæŠŠå¯åŠ¨ä»£ç æ”¾åœ¨é‡Œé¢ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">OldApp</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Running!"</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="type">OldApp</span>()</span><br><span class="line">app.run ()</span><br></pre></td></tr></tbody></table></figure>
<p>Swift ä¼šè‡ªåŠ¨æŠŠ main.swift çœ‹ä½œæœ€é¡¶å±‚çš„ä»£ç ï¼Œåˆ›å»º <code>App</code> å®ä¾‹å¹¶ä¸”è¿è¡Œã€‚å³ä¾¿åœ¨ SE-0281 ä¹‹åè¿™ä¸ªåšæ³•éƒ½ä¸€ç›´è¢«å»¶ç»­ï¼Œä½†ç°åœ¨ä½ å¯ä»¥å¹²æ‰ main.swift äº†ï¼Œè½¬è€Œä½¿ç”¨ <code>@main</code> å±æ€§æ¥æ ‡è®°æŸä¸ªåŒ…å«é™æ€ <code>main</code> æ–¹æ³•çš„ç»“æ„ä½“æˆ–è€…ç±»ï¼Œè®©å®ƒå……å½“ç¨‹åºå…¥å£ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@main</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NewApp</span> </span>{</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Running!"</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸Šé¢çš„ä»£ç æ‰€åœ¨çš„ç¨‹åºè¿è¡Œæ—¶ï¼ŒSwift ä¼šè‡ªåŠ¨è°ƒç”¨ <code>NewApp.main ()</code> æ¥å¯åŠ¨ç¨‹åºæµç¨‹ã€‚</p>
<p>æ–°çš„ <code>@main</code> å±æ€§å¯¹äº UIKit å’Œ AppKit å¼€å‘è€…æ¥è¯´å¯èƒ½æœ‰ç‚¹å±æ€§ï¼Œå› ä¸ºæˆ‘ä»¬æ­£æ˜¯ç”¨ <code>@UIApplicationMain</code> å’Œ <code>@NSApplicationMain</code> æ¥æ ‡è®° app ä»£ç†çš„ã€‚</p>
<p>ä¸è¿‡ï¼Œä½¿ç”¨ <code>@main</code> çš„æ—¶å€™æœ‰ä¸€äº›æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>å·²ç»æœ‰ main.swift æ–‡ä»¶çš„ app ä¸èƒ½ä½¿ç”¨è¿™ä¸ªå±æ€§</li>
<li>ä¸èƒ½æœ‰ä¸€ä¸ªä»¥ä¸Šçš„ <code>@main</code> å±æ€§</li>
<li><code>@main</code> å±æ€§åªèƒ½ç”¨åœ¨æœ€é¡¶å±‚çš„ç±»å‹ä¸Š â€”â€” è¿™ä¸ªç±»å‹ä¸ç»§æ‰¿è‡ªä»»ä½•å…¶ä»–ç±»</li>
</ul>
<h3 id="åŸºäºä¸Šä¸‹æ–‡æ³›å‹å£°æ˜çš„-where-è¯­å¥"><a href="#åŸºäºä¸Šä¸‹æ–‡æ³›å‹å£°æ˜çš„-where-è¯­å¥" class="headerlink" title="åŸºäºä¸Šä¸‹æ–‡æ³›å‹å£°æ˜çš„ where è¯­å¥"></a>åŸºäºä¸Šä¸‹æ–‡æ³›å‹å£°æ˜çš„ <code>where</code> è¯­å¥</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0267-where-on-contextually-generic.md">SE-0267</a> å¼•å…¥ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œä½ å¯ä»¥ç»™æ³›å‹ç±»å‹æˆ–è€…æ‰©å±•æ·»åŠ å¸¦æœ‰ <code>where</code> è¯­å¥é™å®šçš„å‡½æ•°ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ <code>Stack</code>ï¼Œå¯ä»¥å‹æ ˆï¼Œå‡ºæ ˆå…ƒç´ ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Stack</span>&lt;<span class="title">Element</span>&gt; </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> array = [<span class="type">Element</span>]()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(<span class="keyword">_</span> obj: Element)</span></span> {</span><br><span class="line">        array.append (obj)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">()</span></span> -&gt; <span class="type">Element?</span> {</span><br><span class="line">        array.popLast ()</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>å€ŸåŠ© SE-0267ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ·»åŠ ä¸€ä¸ª <code>sorted ()</code> æ–¹æ³•ç»™è¿™ä¸ª <code>Stack</code>ï¼Œå¹¶ä¸”è¦æ±‚è¿™ä¸ªæ–¹æ³•åªæœ‰åœ¨ <code>Stack</code> çš„æ³›å‹å‚æ•° <code>Element</code> éµå¾ª <code>Comparable</code> åè®®çš„æ—¶å€™æ‰èƒ½ä½¿ç”¨ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Stack</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sorted</span><span class="params">()</span></span> -&gt; [<span class="type">Element</span>] <span class="keyword">where</span> <span class="type">Element</span>: <span class="type">Comparable</span> {</span><br><span class="line">        array.sorted ()</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æšä¸¾çš„-cases-å¯ä»¥ä½œä¸º-protocol-witnesses"><a href="#æšä¸¾çš„-cases-å¯ä»¥ä½œä¸º-protocol-witnesses" class="headerlink" title="æšä¸¾çš„ cases å¯ä»¥ä½œä¸º protocol witnesses"></a>æšä¸¾çš„ cases å¯ä»¥ä½œä¸º protocol witnesses</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0280-enum-cases-as-protocol-witnesses.md">SE-0280</a> ä½¿å¾—æšä¸¾å¯ä»¥å‚ä¸ protocol witness matchingï¼Œè¿™æ˜¯ä¸€ç§è¡¨è¿°æˆ‘ä»¬å¯ä»¥æ›´å®¹æ˜“åœ°åŒ¹é…åè®®è¦æ±‚çš„æŠ€æœ¯æ–¹å¼ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä½ å¯ä»¥ç¼–å†™ä»£ç å¤„ç†å„ç§ç±»å‹çš„æ•°æ®ï¼Œä½†æ˜¯å‡å¦‚æ•°æ®ä¸è§äº†æ€ä¹ˆåŠå‘¢ï¼Ÿå½“ç„¶ï¼Œä½ å¯ä»¥å€ŸåŠ©ç©ºåˆè¿ç®—ç¬¦ï¼Œæ¯æ¬¡éƒ½æä¾›ä¸€ä¸ªé»˜è®¤å€¼ã€‚ä¸è¿‡ã€‚ä½ å¯ä»¥å€ŸåŠ©åè®®æ¥è¦æ±‚é»˜è®¤å€¼ï¼Œç„¶åè®©å„ç§ç±»å‹éµå¾ªè¿™ä¸ªåè®®ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Defaultable</span> </span>{</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> defaultValue: <span class="type">Self</span> { <span class="keyword">get</span> }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®©æ•´æ•°æœ‰é»˜è®¤å€¼ 0</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Int</span>: <span class="title">Defaultable</span> </span>{</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> defaultValue: <span class="type">Int</span> { <span class="number">0</span> }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®©æ•°ç»„æœ‰é»˜è®¤å€¼ç©ºæ•°ç»„ </span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span>: <span class="title">Defaultable</span> </span>{</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> defaultValue: <span class="type">Array</span> { [] }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®©å­—å…¸æœ‰é»˜è®¤å€¼ç©ºå­—å…¸ </span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Dictionary</span>: <span class="title">Defaultable</span> </span>{</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> defaultValue: <span class="type">Dictionary</span> { [:] }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>SE-0280 ä½¿å¾—æˆ‘ä»¬èƒ½å¯¹æšä¸¾åšå‡ºä¸€æ ·çš„æ§åˆ¶ã€‚æ¯”å¦‚ï¼Œä½ æœ‰ä¸€ä¸ª <code>padding</code> æšä¸¾ï¼Œå®ƒèƒ½æ¥æ”¶åƒç´ å€¼ï¼Œå˜ç±³å€¼ï¼Œæˆ–è€…æ˜¯ç³»ç»Ÿçš„é»˜è®¤å€¼ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Padding</span>: <span class="title">Defaultable</span> </span>{</span><br><span class="line">    <span class="keyword">case</span> pixels (<span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> cm (<span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> defaultValue</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™æ ·çš„ä»£ç åœ¨ SE-0280 ä¹‹å‰æ˜¯æ— æ³•å®ç°çš„ â€”â€” Swift ä¼šæŠ±æ€¨ <code>Padding</code> ä¸æ»¡è¶³åè®®ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä»”ç»†ç¢ç£¨ä¸€ä¸‹ï¼Œåè®®å…¶å®æ˜¯æ»¡è¶³çš„ï¼šæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé™æ€çš„ <code>defaultValue</code>ï¼Œå®ƒè¿”å› <code>Self</code>ï¼Œæ¢è¨€ä¹‹ï¼Œå°±æ˜¯æŸä¸ªéµå¾ªåè®®çš„å…·ä½“ç±»å‹ï¼Œè€Œè¿™æ­£æ˜¯ <code>Padding.defaultValue</code> æä¾›çš„ã€‚</p>
<h3 id="é‡æ–°æç‚¼çš„-didSet-è¯­ä¹‰"><a href="#é‡æ–°æç‚¼çš„-didSet-è¯­ä¹‰" class="headerlink" title="é‡æ–°æç‚¼çš„ didSet è¯­ä¹‰"></a>é‡æ–°æç‚¼çš„ <code>didSet</code> è¯­ä¹‰</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0268-didset-semantics.md">SE-0268</a> è°ƒæ•´äº† <code>didSet</code> å±æ€§è§‚å¯Ÿè€…çš„å·¥ä½œæ–¹å¼ï¼Œä»¥ä¾¿å®ƒä»¬èƒ½æ›´é«˜æ•ˆåœ°å·¥ä½œã€‚å¯¹äºè¿™ä¸ªä¼˜åŒ–ä½ ä¸éœ€è¦æ”¹åŠ¨ä»»ä½•ä»£ç ï¼Œè‡ªåŠ¨è·å¾—ä¸€ä¸ªå°å°çš„æ€§èƒ½æå‡ã€‚</p>
<p>åœ¨å†…éƒ¨ï¼ŒSwift åšå‡ºçš„æ”¹å˜æ˜¯åœ¨è®¾ç½®æ–°å€¼æ—¶ä¸å†æŸ¥è¯¢æ—§å€¼ã€‚å¦‚æœä½ ä¸ä½¿ç”¨æ—§å€¼ï¼Œä¹Ÿæ²¡æœ‰è®¾ç½® <code>willSet</code>ï¼ŒSwift ä¼šå³æ—¶ä¿®æ”¹æ•°å€¼ã€‚</p>
<p>å‡å¦‚ä½ éœ€è¦ç”¨åˆ°æ—§å€¼ï¼Œåªéœ€è¦å¼•ç”¨ <code>oldValue</code> å³å¯ï¼Œæ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">didSet</span> {</span><br><span class="line">    <span class="keyword">_</span> = oldValue</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ–°çš„-Float16-ç±»å‹"><a href="#æ–°çš„-Float16-ç±»å‹" class="headerlink" title="æ–°çš„ Float16 ç±»å‹"></a>æ–°çš„ Float16 ç±»å‹</h3><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0277-float16.md">SE-0277</a> å¼•å…¥äº†ä¸€ä¸ªæ–°çš„åŠç²¾åº¦æµ®ç‚¹ç±»å‹ï¼Œ<code>Float16</code>ã€‚è¿™ä¸ªç²¾åº¦åœ¨å›¾åƒç¼–ç¨‹å’Œæœºå™¨å­¦ä¹ ä¸­ååˆ†å¸¸è§ã€‚</p>
<p>æ–°ç±»å‹å’Œ Swift åŸæ¥çš„å…¶ä»–ç±»å‹ç›¸ä¼¼ï¼š</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> first: <span class="type">Float16</span> = <span class="number">5</span></span><br><span class="line"><span class="keyword">let</span> second: <span class="type">Float32</span> = <span class="number">11</span></span><br><span class="line"><span class="keyword">let</span> third: <span class="type">Float64</span> = <span class="number">7</span></span><br><span class="line"><span class="keyword">let</span> fourth: <span class="type">Float80</span> = <span class="number">13</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="Swift-Package-Manager-æ”¯æŒäºŒè¿›åˆ¶ä¾èµ–ï¼Œèµ„æºç­‰æ›´å¤šç±»å‹"><a href="#Swift-Package-Manager-æ”¯æŒäºŒè¿›åˆ¶ä¾èµ–ï¼Œèµ„æºç­‰æ›´å¤šç±»å‹" class="headerlink" title="Swift Package Manager æ”¯æŒäºŒè¿›åˆ¶ä¾èµ–ï¼Œèµ„æºç­‰æ›´å¤šç±»å‹"></a>Swift Package Manager æ”¯æŒäºŒè¿›åˆ¶ä¾èµ–ï¼Œèµ„æºç­‰æ›´å¤šç±»å‹</h3><p>Swift 5.3 ä¸º Swift Package Manager (SPM) å¸¦æ¥äº†å¾ˆå¤šæå‡ï¼Œæ•æˆ‘ä¸èƒ½åœ¨è¿™é‡Œä¸€ä¸€ä¸¾ä¾‹ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥è®¨è®ºä¸€ä¸‹ SPM æœ‰å“ªäº›å˜åŒ–ä»¥åŠä¸ºä»€ä¹ˆä¼šæœ‰è¿™äº›å˜åŒ–ã€‚ </p>
<p>é¦–å…ˆï¼Œ<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0271-package-manager-resources.md">SE-0271</a> (Package Manager Resources) ä½¿å¾— SPM èƒ½åŒ…å«è¯¸å¦‚å›¾ç‰‡ï¼ŒéŸ³é¢‘ï¼ŒJSON ç­‰ç±»å‹çš„èµ„æºã€‚è¿™ä¸ªæœºåˆ¶å¯ä¸åªæ˜¯æŠŠæ–‡ä»¶æ‹·è¿›æœ€ç»ˆçš„ app bundle è¿™ä¹ˆç®€å• â€”â€” ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥åº”ç”¨ä¸€ä¸ªè‡ªå®šä¹‰å¤„ç†æ­¥éª¤åˆ°æˆ‘ä»¬çš„ assetsï¼Œæ¯”å¦‚ä¸º iOS ä¼˜åŒ–å›¾ç‰‡ã€‚ä¸ºæ­¤ï¼Œæ–°å¢çš„ <code>Bundle.module</code> å±æ€§å°±æ˜¯ç”¨æ¥åœ¨è¿è¡Œæ—¶è®¿é—®è¿™äº› assets çš„ã€‚<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0278-package-manager-localized-resources.md">SE-0278</a> (Package Manager Localized Resources) è¿›ä¸€æ­¥æ”¯æŒäº†èµ„æºçš„æœ¬åœ°åŒ–ç‰ˆæœ¬ï¼Œä¾‹å¦‚æä¾›é€‚ç”¨æŸä¸ªå›½å®¶çš„å›¾ç‰‡ã€‚</p>
<p>å…¶æ¬¡ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0272-swiftpm-binary-dependencies.md">SE-0272</a> (Package Manager Binary Dependencies) ä½¿å¾— SPM å¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶åŒ…ã€‚è¿™æ„å‘³ç€åƒ Firebase è¿™æ ·çš„é—­æº SDK ç°åœ¨ä¹Ÿå¯ä»¥é€šè¿‡ SPM é›†æˆäº†ã€‚</p>
<p>å†æ¬¡ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0273-swiftpm-conditional-target-dependencies.md">SE-0273</a> (Package Manager Conditional Target Dependencies) å¯ä»¥è®©æˆ‘ä»¬æŒ‡å®šä¸ºç‰¹å®šå¹³å°å’Œé…ç½®ä½¿ç”¨ä¾èµ–ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½åœ¨ä¸º Linux å¹³å°ç¼–è¯‘æ—¶ï¼Œé¢å¤–éœ€è¦æŸäº›ç‰¹å®šçš„æ¡†æ¶ï¼Œæˆ–è€…æˆ‘ä»¬åœ¨æœ¬åœ°æµ‹è¯•çš„æ—¶å€™éœ€è¦ä¸€äº›ä¾èµ–è°ƒè¯•ç”¨çš„æ¡†æ¶ã€‚</p>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒSE-0271 çš„ â€œFuture Directionsâ€ ä¸€èŠ‚ä¸­æåˆ°äº†å¯¹èµ„æºçš„å®‰å…¨è®¿é—® â€”â€” è¿™æ„å‘³ç€åƒ <code>Image ("avatar")</code> è¿™æ ·çš„ä»£ç ä¹‹åä¼šå˜æˆ <code>Image (module.avatar)</code> ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://theinfinitegame.tech/unity-portfolio/tfaces-game-match-hero-progress-daily-20200310/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="çŒ«å…‹æ¯">
      <meta itemprop="description" content="Stay hungry, stay foolish.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="The Infinite Game">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/unity-portfolio/tfaces-game-match-hero-progress-daily-20200310/" class="post-title-link" itemprop="url">Unity Tech | How to implement a â€˜sacrificeâ€™ skill - take bullets for companion ğŸºğŸºğŸº</a>
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-03-21 10:22:05" itemprop="dateCreated datePublished" datetime="2020-03-21T10:22:05+08:00">2020-03-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/unity-portfolio/" itemprop="url" rel="index">
                    <span itemprop="name">unity-portfolio</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>2.6k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>2 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>In our latest game development, I implemented an interesting action: â€œjumping blockâ€.</p>
<p>The team used this skill on the white wolf guard.  The specific skill is called â€œsacrificeâ€. ğŸ¤¨</p>
<blockquote>
<p>Whenever the wolf leader around him receives deadly ballistic damage, the heroic white wolf guard will take a deep leap and block this damage for his boss.</p>
</blockquote>
<p>Here is the video demonstration on Youtube:</p>
<video src="https://www.youtube.com/watch?v=LCN8_GVhync" type="video/mp4" controls="controls" width="100%" height="100%">
</video>


<p>And here is the schematic diagram:</p>
<p><img src="/images/ward fellow by take a bullet for them.png" width="68%" height="68%" style="margin: 10 auto;"></p>
<p>The realization of the jumping block is very interesting ğŸ¤ª. It is a combination of mathematics and physics.</p>
<p>Letâ€™s skip the unimportant part and look directly at the most critical code:</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> A callback invoked when we find a particle(i.e. our bullet) is flying toward something</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="collisionInstance"&gt;</span>a manager contains information about the particle<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="estimatedArrival"&gt;</span>estimated time of flight<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">OnParticleHeadingToTarget</span>(<span class="params">ParticleCollisionInstance collisionInstance, <span class="built_in">float</span> estimatedArrival</span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="comment">// Check if the bullet is flying toward our fellow</span></span><br><span class="line">    <span class="keyword">if</span> (collisionInstance != <span class="literal">null</span> &amp;&amp; collisionInstance.HeadingTarget == wolfFellow.gameObject)</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// Calculate which point should I jump in order to take the bullet for my fellow</span></span><br><span class="line">        jumpSpot = collisionInstance.EvaluateNecessaryArrival(<span class="number">4f</span>, <span class="keyword">out</span> <span class="built_in">float</span> time);</span><br><span class="line">        <span class="comment">// of course, you should look at the bullet when you try to take it.</span></span><br><span class="line">        lookSpot = collisionInstance.gameObject.transform.position;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Every creature has its react time when something happens</span></span><br><span class="line">        <span class="built_in">float</span> reactTime = (_dollAction <span class="keyword">as</span> WolfDollAction).WardJumpToApexDuration;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (reactTime &lt;= time)</span><br><span class="line">        {</span><br><span class="line">            Invoke(<span class="keyword">nameof</span>(WardFellow), time - reactTime);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Ward fellow, for wolf guard, warding is implemented by jump to take bullet for fellow</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WardFellow</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    WolfDollAction wolfAction = _dollAction <span class="keyword">as</span> WolfDollAction;</span><br><span class="line"></span><br><span class="line">    wolfAction.TriggerJumpWard(wolfFellow, jumpSpot, lookSpot);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>the mathematical part, <code>EvaluateNecessaryArrival</code>ï¼š</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Evaluate necessary arrival which we must pass through</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="distanceToHeadingTarget"&gt;</span>distance for the arrival to the target<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="estimatedTime"&gt;</span>out parameter, a estimated time by when we arrive<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>the vector of the must-pass arrival<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Vector3 <span class="title">EvaluateNecessaryArrival</span>(<span class="params"><span class="built_in">float</span> distanceToHeadingTarget, <span class="keyword">out</span> <span class="built_in">float</span> estimatedTime</span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="comment">// Target</span></span><br><span class="line">    <span class="keyword">var</span> heading = HeadingTargetSpot - transform.position;</span><br><span class="line">    <span class="comment">// Distance</span></span><br><span class="line">    <span class="keyword">var</span> currentDistance = heading.magnitude;</span><br><span class="line">    <span class="comment">// Direction</span></span><br><span class="line">    <span class="keyword">var</span> direction = heading / currentDistance;</span><br><span class="line"></span><br><span class="line">    Vector3 arrival = HeadingTargetSpot + direction * -distanceToHeadingTarget;</span><br><span class="line">    estimatedTime = (currentDistance - distanceToHeadingTarget) / MainFlyingParticleVelocity.magnitude;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> arrival;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>Itâ€™s not that difficult, right? ğŸ™Š  Hoping you enjoy this skill. ğŸ˜¬</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="çŒ«å…‹æ¯"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">çŒ«å…‹æ¯</p>
  <div class="site-description" itemprop="description">Stay hungry, stay foolish.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">54</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/nichollyn" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;nichollyn" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/kai-wen-mao-66" title="çŸ¥ä¹ â†’ https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;kai-wen-mao-66" rel="noopener" target="_blank"><i class="fa fa-fw fa-quora"></i>çŸ¥ä¹</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><a href="https://beian.miit.gov.cn/#/Integrated/index" rel="noopener" target="_blank">é—½ICPå¤‡20000913å·-1 </a>
      <img src="/images/gongan.png" style="display: inline-block;"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=35021302000298" rel="noopener" target="_blank">é—½å…¬ç½‘å®‰å¤‡35021302000298å· </a>
  </div>

<div class="copyright">
  
  &copy; 2019 â€“ 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">çŒ«å…‹æ¯</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">238k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">3:37</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>


  



  <script>
  if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id: ,
      el: 'wpac-rating',
      color: 'f79533'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }
  </script>

  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
